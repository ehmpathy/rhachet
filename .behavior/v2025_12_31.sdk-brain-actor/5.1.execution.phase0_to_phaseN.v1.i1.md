# execution: sdk-brain-actor

## status: core implementation complete

remaining:
- integration tests (2.7, 3.5, 4.2, 4.3)
- update invokeRun/invokeAsk to use Actor (3.3, 3.4)
- type tests (5.1)
- final validation (6.1, 6.2)

## phase 0: test fixtures

- [x] **0.1** create `.test/assets/example.repo/rhachet-roles-example.published/` fixture
- [x] **0.2** create `.test/assets/example.repo/rhachet-roles-example.collocated/` fixture
- [x] **0.3** create `.test/assets/example.repo/repo-with-role-with-rigid-skill/` fixture

## phase 1: domain objects

- [x] **1.1** extend `Role` with typed skills structure
- [x] **1.2** create `Actor` domain entity
- [x] **1.3** export `Actor` from domain.objects

## phase 2: domain operations

- [x] **2.1** create `findBrainInAllowlist` operation
- [x] **2.2** create `findSkillBySlug` operation
- [x] **2.3** create `actorAct` operation
- [x] **2.4** create `actorRun` operation
- [x] **2.5** create `actorAsk` operation
- [x] **2.6** create `genActor` factory
- [ ] **2.7** integration tests for actor operations

## phase 3: cli commands

- [x] **3.1** create `invokeAct` command
- [x] **3.2** register `invokeAct` in invoke.ts
- [ ] **3.3** update `invokeRun` to use Actor.run()
- [ ] **3.4** update `invokeAsk` to use Actor.ask()
- [ ] **3.5** CLI integration tests for invokeAct

## phase 4: sdk exports

- [x] **4.1** export `genActor` from sdk
- [ ] **4.2** SDK integration tests (published pattern)
- [ ] **4.3** SDK integration tests (collocated pattern)

## phase 5: type tests

- [ ] **5.1** type tests for skill inference

## phase 6: final validation

- [ ] **6.1** run full test suite
- [ ] **6.2** validate blackbox criteria

---

## execution log

### 2025-12-31

#### completed: phase 0 (test fixtures)

created three test fixtures:
- `rhachet-roles-example.published/` - published pattern with .gitignore for .agent/
- `rhachet-roles-example.collocated/` - collocated pattern with .agent/ checked in
- `repo-with-role-with-rigid-skill/` - CLI invokeAct test fixture

#### completed: phase 1 (domain objects)

- extended Role.ts with `skills.solid` and `skills.rigid` optional properties
- created Actor.ts with typed `.act()`, `.run()`, `.ask()` methods
- exported Actor from domain.objects/index.ts

#### completed: phase 2 (domain operations)

created actor operations:
- `findBrainInAllowlist.ts` - validates brain against actor's allowlist
- `findSkillBySlug.ts` - resolves skill from role.skills or .agent/ dirs
- `actorAct.ts` - executes rigid skill with brain
- `actorRun.ts` - executes solid skill via spawn (no brain)
- `actorAsk.ts` - starts fluid conversation with brain
- `genActor.ts` - factory to create actor from role + brains

all unit tests passing (19 tests)

#### completed: phase 3 (cli commands)

created invokeAct command:
- `invokeAct.ts` - CLI command for `npx rhachet act`
- registered in `invoke.ts`
- added `getBrainReplsByOpts.ts` helper to get brains from config
- added `onInvokeActInput` hook to InvokeHooks

#### completed: phase 4.1 (sdk exports)

exported `genActor` from `src/contract/sdk.ts`
