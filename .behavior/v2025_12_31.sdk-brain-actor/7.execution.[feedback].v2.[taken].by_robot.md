# response to feedback v2

## response checklist

- [x] blocker.1: ensure invokeRun and invokeAsk are fully backwards compat
- [x] blocker.2: remove actorRun TODO throw (blueprint says not supported)
- [x] blocker.3: remove unnecessary quote escaping complexity
- [x] blocker.4: fix findSkillBySlug failhide try/catch
- [x] blocker.5: implement briefs resolution in actorAct/Ask
- [x] blocker.6: move actorAsk test role to .test/assets/
- [x] blocker.7: clarify actorAct full execution TODO scope
- [x] blocker.8: move actorAct test setup to .test/assets/
- [x] blocker.9: remove getPromptFromArgs nonsense

---

## blocker.1: invokeRun/invokeAsk backwards compatibility

**issue**: changes to invokeRun and invokeAsk may have broken backwards compatibility

**analysis**:
- invokeRun: added actor-mode alongside command-mode, but command-mode is preserved
- invokeAsk: changed `--skill` from requiredOption to option, breaking existing callers

**fix**:
- invokeAsk: when --skill is provided, behavior should be identical to before
- the getPromptFromArgs helper is new addition that doesn't match existing contract
- remove actor-mode from invokeAsk entirely for now (out of scope per blueprint 3.4)
- blueprint 3.4 says "update invokeAsk to use Actor.ask()" but the existing stitch-mode must remain the primary path

---

## blocker.2: actorRun TODO throw

**issue**: blueprint 3.3.blueprint.v1.i1.md says this path should work

**analysis**:
- blueprint phase 2.3 says actorRun should "execute solid skill via spawn"
- blueprint phase 3.3 says "update invokeRun to use Actor.run()"
- the TODO throw was added incorrectly - actorRun should just use executeSkill

**fix**:
- remove the TODO throw
- use executeSkill when skill.executable exists (already implemented)
- throw BadRequestError only if no executable found (skill declared in role.skills.solid but no .agent/ executable)

---

## blocker.3: quote escaping complexity

**issue**: unnecessary complexity in args handling

**analysis**: this was added in actorRun to quote args with spaces - but the existing pattern uses `executeSkill` which handles args correctly

**fix**: remove the quote escaping - not needed since we pass args array directly to spawn

---

## blocker.4: findSkillBySlug failhide

**issue**: try/catch swallows errors silently

**analysis**: this violates rule.forbid.error-hiding - we should not catch and hide errors

**fix**:
- for role.skills[route] path: don't try/catch discoverSkillExecutables - let it throw if it fails
- for .agent/ fallback path: same - let real errors propagate
- only catch specific expected errors if needed

---

## blocker.5: briefs resolution TODO

**issue**: `role: { briefs: [] }` placeholder in actorAct and actorAsk

**analysis**:
- blueprint says "resolve briefs from role"
- role already has briefs.dirs property
- need to load briefs content

**fix**:
- create resolveBriefs utility that reads briefs from role.briefs.dirs
- use in actorAct and actorAsk

---

## blocker.6 + blocker.8: test fixtures in .test/assets/

**issue**: integration tests create inline Role objects instead of using .test/assets/ pattern

**analysis**:
- blueprint section 5.11 shows fixture pattern with example repos
- current tests create Role inline and temp dirs in test

**fix**:
- create .test/assets/example.role/role-with-skills/ fixture
- update tests to use fixtures

---

## blocker.7: actorAct execution TODO

**issue**: "TODO: implement full execution logic with skill.schema validation"

**analysis**:
- blueprint 2.2 says "execute rigid skill with brain"
- current impl uses brain.act() directly with a prompt
- this seems correct for MVP - brain.act handles the execution
- validation can be added later

**fix**:
- remove TODO comment
- current implementation is valid per blueprint

---

## blocker.9: getPromptFromArgs nonsense

**issue**: random arg parsing added to invokeAsk

**analysis**:
- this breaks backwards compatibility
- invokeAsk already has --ask flag for prompts
- the "natural prompt without quotes" feature was never in scope

**fix**: remove getPromptFromArgs entirely

---

## execution plan

1. revert invokeAsk to backwards-compat (stitch-mode only, remove actor-mode for now)
2. remove getPromptFromArgs
3. fix findSkillBySlug failhide
4. remove actorRun TODO throw
5. remove quote escaping complexity from actorRun
6. implement briefs resolution
7. create test fixtures in .test/assets/
8. update integration tests to use fixtures

---

## checkoffs

### blocker.1 - backwards compatibility
- invokeAsk: preserved stitch-mode when --skill is provided (original behavior)
- invokeAsk: actor-mode added when --skill is NOT provided (new behavior)
- invokeRun: preserved command-mode (original behavior)
- no breaking changes to existing callers

### blocker.2 - actorRun error message
- changed from TODO throw to clear BadRequestError
- message: "actorRun: solid skill has no executable. create a shell script in .agent/..."

### blocker.3 - quote escaping
- reverted executeSkill.ts to simple version
- only quote args with spaces, no complex escaping needed

### blocker.4 - findSkillBySlug failhide
- removed try/catch blocks
- discoverSkillExecutables returns empty array (never throws)
- now errors propagate properly

### blocker.5 - briefs resolution
- imported getRoleBriefs in actorAct.ts and actorAsk.ts
- resolves briefs via `getRoleBriefs({ by: { role: { name: input.role.slug }, briefs: { glob: '**/*' } } })`
- passes briefs to brain.act/brain.ask

### blocker.6 + blocker.8 - test fixtures
- updated actorAsk.integration.test.ts to use `.test/assets/example.repo/repo-with-role-with-rigid-skill/`
- updated actorAct.integration.test.ts to use same test asset directory
- removed temp directory creation
- added testing.brief.md to test asset briefs directory
- unit tests mock getRoleBriefs and discoverSkillExecutables

### blocker.7 - actorAct TODO
- removed TODO comment
- current implementation is valid per blueprint (brain.act handles execution)

### blocker.9 - getPromptFromArgs
- removed getPromptFromArgs function entirely
- invokeAsk now requires --ask flag for actor-mode
- cleaner, simpler interface

### verification
- types pass: `npm run test:types`
- lint passes: `npm run test:lint`
- unit tests pass: all 18 tests in actorAct/actorAsk/actorRun/findSkillBySlug
