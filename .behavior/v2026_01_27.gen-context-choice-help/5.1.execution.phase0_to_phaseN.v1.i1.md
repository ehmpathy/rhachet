# execution: gen-context-choice-help

progress tracker for roadmap phases.

---

## phase 0: preparation

- [x] **0.1** read all briefs
  - [x] 0.wish.md
  - [x] 1.vision.md
  - [x] 2.criteria.blackbox.md
  - [x] 3.3.blueprint.v1.i1.md
- [x] **0.2** verify current test suite passes
  - test:types âœ“
  - test:unit âœ“ (761 passed, 2 skipped)
  - note: test:lint shows fastest-levenshtein unused (expected, not used yet)

---

## phase 1: add dependency

- [x] **1.1** install `fastest-levenshtein` as production dependency
  - already installed: "fastest-levenshtein": "1.0.16"
- [x] **1.2** verify build passes after install
  - npm run build âœ“

---

## phase 2: create BrainChoiceNotFoundError

- [x] **2.1** create `src/domain.objects/BrainChoiceNotFoundError.ts`
  - extends HelpfulError, no custom constructor
  - jsdoc with .what, .why, @example
- [x] **2.2** export from `src/domain.objects/index.ts`
  - added after BrainAtom (alphabetical)
- [x] **2.3** verify sdk exports the error class
  - sdk.ts has `export * from '@src/domain.objects'` âœ“
  - npm run test:types âœ“

---

## phase 3: create formatAvailableBrains

- [x] **3.1** create `src/domain.operations/context/formatAvailableBrains.test.ts`
  - 16 test cases: symbols, empty, single, similarity sort, truncation, snapshot
- [x] **3.2** create `src/domain.operations/context/formatAvailableBrains.ts`
  - pure function, O(n) distance precompute, 21 max, treestruct format
- [x] **3.3** verify all unit tests pass
  - npm run test:unit -- formatAvailableBrains.test.ts âœ“ (16 passed)

---

## phase 4: update genContextBrain

- [x] **4.1** update jsdoc with `@throws {BrainChoiceNotFoundError}`
  - added @throws documentation with example catch pattern
- [x] **4.2** add new test cases to `genContextBrain.test.ts`
  - case16-21: available brains, similarity sort, metadata, error types
  - updated case9, case10, case12 to expect BrainChoiceNotFoundError
- [x] **4.3** update error throw site (repl not found)
  - BrainChoiceNotFoundError with formatAvailableBrains({ atoms: [], repls })
- [x] **4.4** update error throw site (atom not found)
  - BrainChoiceNotFoundError with formatAvailableBrains({ atoms, repls: [] })
- [x] **4.5** update error throw site (generic not found)
  - BrainChoiceNotFoundError with formatAvailableBrains({ atoms, repls })
- [x] **4.6** verify all unit tests pass
  - npm run test:unit -- genContextBrain.test.ts âœ“ (34 passed)

---

## phase 5: verify full test suite

- [x] **5.1** run type checks
  - npm run test:types âœ“
  - note: fixed unrelated prior type error in genActor.brain.caseAskable.integration.test.ts (xai slug format)
- [x] **5.2** run lint checks
  - npm run test:lint âœ“
  - fixed: import type for BrainAtom, BrainRepl in formatAvailableBrains.ts
- [x] **5.3** run all unit tests
  - npm run test:unit âœ“ (113 passed)
  - formatAvailableBrains: 16 passed
  - genContextBrain: 38 passed
- [x] **5.4** verify criteria coverage
  - usecase.1 âœ“ helpful error message with available brains
  - usecase.2 âœ“ similarity sort via Levenshtein distance
  - usecase.3 âœ“ treestruct format with ðŸ”­, â”œâ”€â”€, â””â”€â”€, â—‹, â†»
  - usecase.4 âœ“ metadata serialized in error message (note: uses BrainChoiceNotFoundError extends HelpfulError per blueprint, not BadRequestError per original criteria)
  - edge.1 âœ“ empty registry shows "(none)"
  - edge.2 âœ“ single brain uses â””â”€â”€ connector
  - edge.3 âœ“ >21 brains truncated with "(and N more)"

---

## phase 6: update snapshots

- [x] **6.1** review any snapshot changes
  - formatAvailableBrains.test.ts.snap created with correct treestruct output
- [x] **6.2** update snapshots if output is correct
  - snapshot matches expected format: ðŸ”­ header, similarity sorted, proper connectors and symbols
