# blackbox criteria matrix: `--prep` flag

## matrix.1: prepare entry mutation

how the `prepare` entry in package.json changes based on its prior state.

| ind: prepare entry prior | ind: prepare:rhachet prior | dep: prepare entry after | dep: mutation type |
|--------------------------|----------------------------|--------------------------|--------------------|
| absent | absent | `npm run prepare:rhachet` | create |
| absent | extant | `npm run prepare:rhachet` | create |
| `husky install` | absent | `husky install && npm run prepare:rhachet` | append |
| `husky install` | extant | `husky install && npm run prepare:rhachet` | unchanged |
| `husky install && npm run prepare:rhachet` | extant | `husky install && npm run prepare:rhachet` | unchanged |
| `npm run prepare:rhachet` | extant | `npm run prepare:rhachet` | unchanged |

**gap check**: all combinations covered. no absent rows.

---

## matrix.2: prepare:rhachet entry mutation

how the `prepare:rhachet` entry changes based on `--hooks` flag and prior state.

| ind: --hooks passed | ind: prepare:rhachet prior | dep: prepare:rhachet after | dep: hooks configured now |
|---------------------|----------------------------|----------------------------|---------------------------|
| yes | absent | `npx rhachet init --hooks --roles ...` | yes |
| yes | extant with --hooks | `npx rhachet init --hooks --roles ...` (updated roles) | yes |
| yes | extant without --hooks | `npx rhachet init --hooks --roles ...` | yes |
| no | absent | `npx rhachet init --roles ...` | no |
| no | extant with --hooks | `npx rhachet init --roles ...` | no |
| no | extant without --hooks | `npx rhachet init --roles ...` (updated roles) | no |

**gap check**: all 6 combinations covered. no absent rows.

---

## matrix.3: error conditions

when errors are surfaced based on input state.

| ind: package.json state | ind: --prep passed | ind: --roles passed | dep: error surfaced | dep: operation proceeds |
|-------------------------|--------------------|--------------------|---------------------|-------------------------|
| absent | yes | yes | "no package.json found" | no |
| invalid json | yes | yes | "invalid package.json" | no |
| valid | yes | no | "--prep requires --roles" | no |
| valid | yes | yes | none | yes |
| valid | no | yes | none | yes (standard init) |
| valid | no | no | none | yes (standard init, no roles) |

**gap check**: all meaningful combinations covered.

---

## matrix.4: flag order independence

verifies that flag order does not affect outcome.

| ind: flag arrangement | dep: outcome identical |
|-----------------------|------------------------|
| `--hooks --prep --roles x` | yes |
| `--prep --hooks --roles x` | yes |
| `--roles x --prep --hooks` | yes |
| `--roles x --hooks --prep` | yes |
| `--prep --roles x --hooks` | yes |
| `--hooks --roles x --prep` | yes |

**gap check**: all 6 permutations of 3 flags yield identical outcome.

---

## matrix.5: teammate clone experience

verifies that `npm install` on a fresh clone produces correct setup.

| ind: persisted --hooks | ind: teammate runs npm install | dep: roles linked | dep: hooks configured |
|------------------------|-------------------------------|-------------------|----------------------|
| yes | yes | yes | yes |
| no | yes | yes | no |

**gap check**: both cases covered.

---

## decomposition analysis

**dimension count**: matrices have 2-3 independent variables each â€” well within maintainable bounds.

**no decomposition needed**: the feature has clear behavioral boundaries:
- prepare entry mutation logic
- prepare:rhachet entry mutation logic
- error surface logic
- flag parse logic

these are orthogonal concerns that do not create combinatorial explosion.

---

## coverage summary

| matrix | combinations | covered | gaps |
|--------|--------------|---------|------|
| prepare entry mutation | 6 | 6 | 0 |
| prepare:rhachet mutation | 6 | 6 | 0 |
| error conditions | 6 | 6 | 0 |
| flag order independence | 6 | 6 | 0 |
| teammate clone | 2 | 2 | 0 |

**total**: 26 combinations, 0 gaps.
