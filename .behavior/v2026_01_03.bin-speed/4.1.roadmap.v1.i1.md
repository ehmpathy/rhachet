# roadmap v1: bin-speed

execution checklist for blueprint v1.

---

## phase 0: file structure setup

### 0.1 rename bin/run to bin/run.jit

- [ ] `git mv bin/run bin/run.jit`

**acceptance**: bin/run.jit exists and executes rhachet commands
**verify**: `./bin/run.jit --help` outputs help text

---

### 0.2 update .gitignore for *.bc

- [ ] add `*.bc` to .gitignore

**acceptance**: compiled binaries excluded from git
**verify**: `git status` does not show *.bc files after build

depends: none

---

### 0.3 update dispatcher binary paths

- [ ] update `invoke.bun.entry.dispatch.ts` to use `run.bun.*.bc` file names

**acceptance**: dispatcher routes to correct binary names
**verify**: read file and confirm paths match `run.bun.rhachet-run.bc`, `run.bun.rhachet-roles.bc`, `run.bun.rhachet-all.bc`

depends: none

---

## phase 1: build system

### 1.1 add build:bun scripts to package.json

- [ ] add `build:bun` script
- [ ] add `build:bun:dispatcher` script
- [ ] add `build:bun:run` script
- [ ] add `build:bun:roles` script
- [ ] add `build:bun:all` script

**acceptance**: `npm run build:bun` compiles all 4 binaries
**verify**: `npm run build:bun` succeeds and creates 4 files in bin/

depends: 0.3

---

### 1.2 update main build script

- [ ] update `build` script to include `build:bun`

**acceptance**: `npm run build` produces both dist/ and bin/*.bc
**verify**: `npm run build` succeeds and bin/*.bc files exist

depends: 1.1

---

### 1.3 build all binaries

- [ ] run `npm run build:bun`

**acceptance**: all 4 binaries created
**verify**:
- `ls bin/run.bun.dispatcher.bc` exists
- `ls bin/run.bun.rhachet-run.bc` exists
- `ls bin/run.bun.rhachet-roles.bc` exists
- `ls bin/run.bun.rhachet-all.bc` exists

depends: 1.1

---

## phase 2: symlink chain

### 2.1 create bin/run.bun symlink

- [ ] `ln -sf run.bun.dispatcher.bc bin/run.bun`

**acceptance**: bin/run.bun points to dispatcher
**verify**: `ls -la bin/run.bun` shows symlink to run.bun.dispatcher.bc

depends: 1.3

---

### 2.2 create bin/run symlink

- [ ] `ln -sf run.bun bin/run`

**acceptance**: bin/run points to bin/run.bun
**verify**: `ls -la bin/run` shows symlink to run.bun

depends: 2.1

---

### 2.3 verify symlink chain works

- [ ] test dispatcher routes correctly

**acceptance**: `bin/run run --skill perf.test` executes skill
**verify**: `./bin/run run --skill perf.test` outputs skill execution

depends: 2.2

---

## phase 3: performance verification

### 3.1 verify run --skill performance

- [ ] measure `bin/run run --skill perf.test` time

**acceptance**: averages <100ms across multiple runs
**verify**: `DEBUG_PERF=true ./bin/run run --skill perf.test` shows dispatch.done <100ms

depends: 2.3

---

### 3.2 verify roles boot performance

- [ ] measure `bin/run roles boot` time

**acceptance**: averages <250ms across multiple runs
**verify**: `DEBUG_PERF=true ./bin/run roles boot --role any --if-present` shows dispatch.done <250ms

depends: 2.3

---

### 3.3 verify roles init performance

- [ ] measure `bin/run roles init` time

**acceptance**: averages <250ms across multiple runs
**verify**: `DEBUG_PERF=true ./bin/run roles init --repo ehmpathy --role mechanic --command claude.hooks/pretooluse.forbid-gerunds` shows dispatch.done <250ms

depends: 2.3

---

## phase 4: backward compatibility

### 4.1 verify bin/run.jit fallback

- [ ] test JIT entrypoint still works

**acceptance**: bin/run.jit executes all commands correctly
**verify**: `./bin/run.jit run --skill perf.test` succeeds

depends: 0.1

---

### 4.2 verify all commands route through dispatcher

- [ ] test ask routes to rhachet-all
- [ ] test act routes to rhachet-all
- [ ] test list routes to rhachet-all
- [ ] test readme routes to rhachet-all
- [ ] test choose routes to rhachet-all
- [ ] test init routes to rhachet-all

**acceptance**: all commands execute correctly via dispatcher
**verify**: each command produces expected output (or expected error for commands that require input)

depends: 2.3

---

## phase 5: acceptance tests

### 5.1 create genTestTempRepo fixture for performance tests

- [ ] add fixture with rhachet.use.ts that includes rhachet-roles-ehmpathy
- [ ] add fixture with collocated perf.test skill

**acceptance**: fixture provides isolated test environment with linked roles
**verify**: fixture can be created and roles linked

depends: none

---

### 5.2 create run.performance.acceptance.test.ts

- [ ] test `run --skill perf.test` (collocated) averages <100ms
- [ ] test `run --skill cpsafe` (published) averages <100ms

**acceptance**: both tests pass with 30-run average <100ms
**verify**: `npm run test:acceptance -- run.performance` passes

depends: 5.1, 2.3

---

### 5.3 create roles.boot.performance.acceptance.test.ts

- [ ] test `roles boot --role any --if-present` (collocated) averages <250ms
- [ ] test `roles boot --repo ehmpathy --role mechanic` (published) averages <250ms

**acceptance**: both tests pass with 30-run average <250ms
**verify**: `npm run test:acceptance -- roles.boot.performance` passes

depends: 5.1, 2.3

---

### 5.4 create roles.init.performance.acceptance.test.ts

- [ ] test `roles init --repo ehmpathy --role mechanic --command claude.hooks/pretooluse.forbid-gerunds` averages <250ms

**acceptance**: test passes with 30-run average <250ms
**verify**: `npm run test:acceptance -- roles.init.performance` passes

depends: 5.1, 2.3

---

## phase 6: final verification

### 6.1 run full test suite

- [ ] `npm run test`

**acceptance**: all tests pass (types, format, lint, unit, integration, acceptance)
**verify**: `npm run test` exits 0

depends: 5.2, 5.3, 5.4

---

### 6.2 verify success criteria

- [ ] `bin/run run --skill` averages <100ms (30 runs)
- [ ] `bin/run roles boot` averages <250ms (30 runs)
- [ ] `bin/run roles init` averages <250ms (30 runs)
- [ ] all commands (ask, act, list, etc.) work correctly
- [ ] bin/run.jit fallback works
- [ ] acceptance tests pass

**acceptance**: all success criteria met
**verify**: manual verification of each criterion

depends: 6.1

---

## execution order summary

```
0.1 rename bin/run → bin/run.jit
0.2 update .gitignore
0.3 update dispatcher paths
    ↓
1.1 add build:bun scripts
1.2 update main build script
1.3 build all binaries
    ↓
2.1 create bin/run.bun symlink
2.2 create bin/run symlink
2.3 verify symlink chain
    ↓
3.1 verify run --skill perf
3.2 verify roles boot perf
3.3 verify roles init perf
    ↓
4.1 verify bin/run.jit fallback
4.2 verify all commands route
    ↓
5.1 create test fixture
5.2 create run perf test
5.3 create roles boot perf test
5.4 create roles init perf test
    ↓
6.1 run full test suite
6.2 verify success criteria
```
