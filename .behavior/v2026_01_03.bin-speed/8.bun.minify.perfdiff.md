# bun --minify performance diff report

## .date

2026-01-05

## .summary

tests performance impact of `--minify --sourcemap` flags on bun build commands.

## .build commands

### before
```sh
bun build ./src/contract/cli/invoke.bun.entry.run.ts --compile --bytecode --outfile ./bin/run.bun.rhachet-run.bc
bun build ./src/contract/cli/invoke.bun.entry.roles.ts --compile --bytecode --outfile ./bin/run.bun.rhachet-roles.bc
```

### after
```sh
bun build ./src/contract/cli/invoke.bun.entry.run.ts --compile --bytecode --minify --sourcemap --outfile ./bin/run.bun.rhachet-run.bc
bun build ./src/contract/cli/invoke.bun.entry.roles.ts --compile --bytecode --minify --sourcemap --outfile ./bin/run.bun.rhachet-roles.bc
```

## .build output

### before (without --minify --sourcemap)
```
> bun build ./src/contract/cli/invoke.bun.entry.run.ts --compile --bytecode --outfile ./bin/run.bun.rhachet-run.bc
 [328ms]  bundle  156 modules
 [280ms] compile  ./bin/run.bun.rhachet-run.bc

> bun build ./src/contract/cli/invoke.bun.entry.roles.ts --compile --bytecode --outfile ./bin/run.bun.rhachet-roles.bc
 [169ms]  bundle  54 modules
 [343ms] compile  ./bin/run.bun.rhachet-roles.bc
```

### after (with --minify --sourcemap)
```
> bun build ./src/contract/cli/invoke.bun.entry.run.ts --compile --bytecode --minify --sourcemap --outfile ./bin/run.bun.rhachet-run.bc
  [78ms]  minify  -223.78 KB (estimate)
  [95ms]  bundle  156 modules
 [337ms] compile  ./bin/run.bun.rhachet-run.bc

> bun build ./src/contract/cli/invoke.bun.entry.roles.ts --compile --bytecode --minify --sourcemap --outfile ./bin/run.bun.rhachet-roles.bc
  [28ms]  minify  -127.70 KB (estimate)
  [68ms]  bundle  54 modules
 [458ms] compile  ./bin/run.bun.rhachet-roles.bc
```

## .binary sizes

| binary | before | after | diff |
|--------|--------|-------|------|
| `run.bun.rhachet-run.bc` | 102M | 102M | 0 |
| `run.bun.rhachet-roles.bc` | 101M | 101M | 0 |

note: minification affects the embedded JS bundle (~224KB / ~128KB reduction), but the bun runtime comprises the majority of the binary size, so total file size remains unchanged.

## .runtime performance

### `run --skill perf.test` (20 runs, 5 warmup)

| metric | before | after | diff |
|--------|--------|-------|------|
| mean | 205ms | 220ms | +15ms (+7%) |
| min | 144ms | 140ms | -4ms |
| max | 335ms | 323ms | -12ms |
| stddev | 50ms | 55ms | +5ms |

### `roles boot --repo .this --role any` (20 runs, 5 warmup)

| metric | before | after | diff |
|--------|--------|-------|------|
| mean | 128ms | 151ms | +23ms (+18%) |
| min | 84ms | 96ms | +12ms |
| max | 202ms | 223ms | +21ms |
| stddev | 30ms | 42ms | +12ms |

## .analysis

1. **binary size**: unchanged - minification only affects the JS bundle inside, not the bun runtime
2. **runtime performance**: slightly worse with minification
   - `run --skill`: +7% slower (within measurement variance)
   - `roles boot`: +18% slower (notable but within acceptable range)
3. **variance**: increased stddev suggests minified code may have less predictable performance

## .conclusion

the `--minify` flag provides minimal benefit for bun-compiled binaries:
- no binary size reduction (bun runtime dominates)
- slight runtime performance degradation
- increased variance

### recommendation

for production bun binaries, prefer:
```sh
bun build --compile --bytecode --sourcemap --outfile ./bin/run.bc
```

skip `--minify` unless you need to debug bundle contents.

note: `--sourcemap` is retained for debuggability without performance impact.

## .sourcemap-only results

tested with `--sourcemap` only (no `--minify`):

### `run --skill perf.test` (20 runs, 5 warmup)

| metric | baseline (no flags) | sourcemap only | minify + sourcemap |
|--------|---------------------|----------------|---------------------|
| mean | 205ms | 210ms (+2%) | 220ms (+7%) |
| min | 144ms | 146ms | 140ms |
| max | 335ms | 313ms | 323ms |
| stddev | 50ms | 56ms | 55ms |

### `roles boot --repo .this --role any` (20 runs, 5 warmup)

| metric | baseline (no flags) | sourcemap only | minify + sourcemap |
|--------|---------------------|----------------|---------------------|
| mean | 128ms | 132ms (+3%) | 151ms (+18%) |
| min | 84ms | 94ms | 96ms |
| max | 202ms | 181ms | 223ms |
| stddev | 30ms | 26ms | 42ms |

## .final conclusion

- `--sourcemap`: negligible performance impact (+2-3%), retains debuggability
- `--minify`: degrades performance (+7-18%), provides no binary size benefit

### final build commands (adopted)

```sh
bun build --compile --bytecode --sourcemap --outfile ./bin/run.bc
```

skip `--minify` for production bun binaries.
