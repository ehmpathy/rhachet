# defect: bun compiled binary cannot resolve peer modules from target repo

## .what

when a bun-compiled binary (`./bin/run`) does a dynamic import of a config file (`rhachet.use.ts`) from a target repo, and that config file imports from npm packages in the target repo's `node_modules/`, bun fails to resolve those packages.

```
error: Cannot find package 'rhachet-roles-ehmpathy' from '/tmp/rhachet-test-.../rhachet.use.ts'
```

## .why

bun-compiled binaries embed module resolution at compile time. when the binary does:

```ts
const config = await import('/path/to/target/rhachet.use.ts');
```

bun attempts to resolve imports within that file (e.g., `from 'rhachet-roles-ehmpathy'`) via the binary's embedded module graph, not the target repo's `node_modules/`.

this is a fundamental limitation of how `bun build --compile` works:
- static imports are bundled into the binary at compile time
- dynamic imports of external files work, but their transitive imports resolve against the binary's module graph
- there's no runtime reconfiguration of module resolution paths

## .scope

affects all CLI commands that load `rhachet.use.ts`:
- `rhachet roles link`
- `rhachet roles boot`
- `rhachet roles init`
- `rhachet run`
- `rhachet act`
- `rhachet ask`

## .reproduction

```ts
// accept.blackbox/cli/roles.boot.published.acceptance.test.ts
// 1. create temp repo with rhachet + rhachet-roles-ehmpathy installed via pnpm
// 2. rhachet.use.ts imports from 'rhachet-roles-ehmpathy'
// 3. invoke local bun binary: ./bin/run roles link --repo ehmpathy --role mechanic
// 4. fails with: Cannot find package 'rhachet-roles-ehmpathy'
```

## .research

### bun github issues

- [#11732](https://github.com/oven-sh/bun/issues/11732): "bun build --compile: include non-statically analyzable dynamic imports with a flag"
  - confirms this is a known limitation
  - proposed solution: `--include <path>` flag (similar to deno)
  - no resolution yet

- [#6351](https://github.com/oven-sh/bun/issues/6351): "--external option to treat all node_modules packages as external"
  - related to build-time externalization
  - doesn't solve runtime resolution

### deno comparison

deno compile has the same limitation but offers `--include <path>` to bundle additional files. however, this doesn't solve the problem of how to resolve packages from a different project's node_modules at runtime.

### node.js behavior

node.js doesn't have this issue because:
- node.js runtime always resolves modules from the filesystem
- there's no "compiled binary" mode that embeds modules
- dynamic imports naturally use the cwd's node_modules

## .impact

- users who install `rhachet` globally or in one project cannot use it to manage roles from npm packages in another project
- the primary use case of `rhachet-roles-*` packages installed via npm is broken when the bun binary is invoked
- workaround: use `npx rhachet` from within the target project (uses that project's installed rhachet)

## .constraints

any solution must:
1. work with the current bun-compiled binary distribution
2. not require users to install additional runtimes
3. maintain performance (avoid subprocess spawn for every command if possible)
4. support the full RoleRegistry object (with functions/methods on domain objects)
