# blackbox criteria: bin-speed

experience bounds required to fulfill the wish.

---

## usecase.1 = run --skill executes with minimal latency

```
given(a repo with linked roles)
  when(user invokes `bin/run run --skill <skill-name>`)
    then(the skill executes successfully)
    then(the total execution time is under 350ms on average across 30 runs)
      sothat(users experience responsive skill execution)
    then(the total execution time â‰ˆ bun binary load (~200ms) + CLI logic (~50ms) + skill execution)
      sothat(overhead is understood and acceptable for bun-compiled binaries)
```

note: bun-compiled binaries embed the full ~100MB runtime, which causes ~200ms load time.
this is a known limitation (see github.com/oven-sh/bun/issues/14546).
the 350ms threshold accounts for: binary load (200ms) + CLI (50ms) + skill (50ms) + variance (50ms).

---

## usecase.2 = roles boot executes with minimal latency

```
given(a repo with linked roles)
  when(user invokes `bin/run roles boot --role <role-name>`)
    then(the role resources are output successfully)
    then(the total execution time is under 750ms on average across 30 runs)
      sothat(users experience responsive role context load)
```

note: roles boot uses rhachet-roles binary (681 modules) which has higher load time than run (151 modules).

---

## usecase.3 = roles init executes with minimal latency

```
given(a repo with linked roles)
  when(user invokes `bin/run roles init --role <role-name> --command <command-name>`)
    then(the init script executes successfully)
    then(the total execution time is under 750ms on average across 30 runs)
      sothat(users experience responsive init execution)
```

note: roles init uses rhachet-roles binary (681 modules) and spawns an init script.

---

## usecase.4 = all other commands remain functional

```
given(a repo with rhachet.use.ts)
  when(user invokes any rhachet command (ask, act, list, readme, choose, init))
    then(the command executes successfully with same behavior as before)
      sothat(speed optimizations do not break prior functionality)
```

---

## edge.1 = cold start vs warm start

```
given(the rhachet binary has not been recently executed)
  when(user invokes `bin/run run --skill <skill-name>` for the first time)
    then(cold start may take 300-500ms due to binary load from disk)
    then(subsequent runs benefit from OS page cache and average 200-350ms)
      sothat(cold start variance is acceptable but sustained performance is guaranteed)
```

note: the ~100MB bun binary must be loaded from disk on cold start.
after OS caches the binary, subsequent loads are faster.

---

## edge.2 = absent skill graceful failure

```
given(a repo with .agent/ directory)
  when(user invokes `bin/run run --skill <nonexistent-skill>`)
    then(the command fails with helpful error message)
    then(the failure occurs within 350ms total)
      sothat(even error paths complete in acceptable time)
```

---

## edge.3 = absent role graceful failure

```
given(a repo with rhachet.use.ts)
  when(user invokes `bin/run roles boot --role <nonexistent-role>`)
    then(the command fails with helpful error message)
    then(the failure occurs within 450ms total)
      sothat(even error paths complete in acceptable time)
```

---

## boundary.1 = threshold definitions

```
given(the performance thresholds)
  when(execution time is measured)
    then(run --skill: < 350ms average across 30 runs)
      note(uses dispatcher with inlined run, 151 modules)
    then(roles boot: < 750ms average across 30 runs)
      note(uses rhachet-roles binary, 681 modules)
    then(roles init: < 750ms average across 30 runs)
      note(uses rhachet-roles binary, 681 modules)
    then(individual runs may exceed thresholds due to system variance)
      sothat(flaky failures from transient system load are avoided)
```

note: thresholds account for bun binary load time which scales with module count.
see github.com/oven-sh/bun/issues/14546 for the minimal runtime request.

---

## boundary.2 = direct invocation baseline

```
given(a skill script at .agent/repo=X/role=Y/skills/Z.sh)
  when(user measures direct execution time via `time ./path/to/Z.sh`)
    then(this establishes the baseline execution time)
  when(user measures rhachet execution time via `time bin/run run --skill Z`)
    then(the difference is the CLI overhead under test)
```
