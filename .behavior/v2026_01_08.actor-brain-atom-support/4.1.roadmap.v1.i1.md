# roadmap.v1.i1

## wish summary

1. support `BrainAtom` in `actor.ask()` in addition to `BrainRepl`
2. create demo library `rhachet-brain-xai` for `BrainAtom({ repo: xai, slug: 'grok/code-fast-1' })`
3. demonstrate via integration test: `actor.ask()` writing prose about "sunshine ocean surfer turtles"

---

## execution checklist

### phase 0: ActorBrain type and Actor extension

**depends on**: nothing (foundation)

#### step 0.1: create ActorBrain type

- [ ] add `ActorBrain` type to `src/domain.objects/Actor.ts`

**acceptance criteria**:
```
given('ActorBrain type is declared')
  when('type is inspected')
    then('is union of BrainRepl | BrainAtom')
    then('exported from Actor.ts')
```

**verification**:
```sh
npm run test:types
# expect: no type errors
```

---

#### step 0.2: update Actor interface

- [ ] change `brains: BrainRepl[]` to `brains: ActorBrain[]` in Actor interface

**acceptance criteria**:
```
given('Actor interface updated')
  when('Actor.brains is assigned [BrainAtom]')
    then('typescript accepts the assignment')
  when('Actor.brains is assigned [BrainRepl]')
    then('typescript accepts the assignment')
  when('Actor.brains is assigned [BrainAtom, BrainRepl]')
    then('typescript accepts the assignment')
```

**verification**:
```sh
npm run test:types
# expect: no type errors
```

---

### phase 1: actorAsk operation extension

**depends on**: phase 0 (ActorBrain type must exist)

#### step 1.1: update actorAsk signature

- [ ] change `brain: BrainRepl` to `brain: ActorBrain` in `src/domain.operations/actor/actorAsk.ts`

**acceptance criteria**:
```
given('actorAsk signature updated')
  when('called with BrainAtom')
    then('typescript accepts the call')
  when('called with BrainRepl')
    then('typescript accepts the call')
```

**verification**:
```sh
npm run test:types
# expect: no type errors
```

---

#### step 1.2: add unit tests for actorAsk with BrainAtom

- [ ] add test case for BrainAtom in `src/domain.operations/actor/actorAsk.test.ts`

**acceptance criteria**:
```
given('[caseN] actorAsk with BrainAtom')
  when('[t0] called with mock BrainAtom')
    then('calls brain.ask() with prompt')
    then('returns { response: string }')
```

**verification**:
```sh
npm run test:unit -- actorAsk.test.ts
# expect: all tests pass including new BrainAtom case
```

---

### phase 2: genActor operation extension

**depends on**: phase 1 (actorAsk must accept ActorBrain)

#### step 2.1: update genActor signature

- [ ] change `brains: BrainRepl[]` to `brains: ActorBrain[]` in `src/domain.operations/actor/genActor.ts`

**acceptance criteria**:
```
given('genActor signature updated')
  when('called with brains: [BrainAtom]')
    then('typescript accepts the call')
  when('called with brains: [BrainRepl, BrainAtom]')
    then('typescript accepts the call')
```

**verification**:
```sh
npm run test:types
# expect: no type errors
```

---

#### step 2.2: add runtime check for .act()

- [ ] add runtime validation in `.act()` method to ensure brain has `.act()` method
- [ ] throw `BadRequestError` if brain lacks `.act()` method

**acceptance criteria**:
```
given('genActor with BrainAtom')
  when('actor.act() is called with BrainAtom')
    then('throws BadRequestError')
    then('error message is "actor.act() requires a BrainRepl brain with .act() method"')
    then('error metadata contains brainSlug')
```

**verification**:
```sh
npm run test:types
# expect: no type errors (implementation compiles)
```

---

#### step 2.3: add unit tests for genActor with BrainAtom

- [ ] add test case for BrainAtom as default brain
- [ ] add test case for mixed brains [BrainAtom, BrainRepl]
- [ ] add test case for .act() rejection with BrainAtom

**acceptance criteria**:
```
given('[caseN] genActor with BrainAtom')
  when('[t0] created with BrainAtom as default brain')
    then('actor is created successfully')
  when('[t1] actor.ask() is called')
    then('uses BrainAtom.ask()')
    then('returns { response: string }')
  when('[t2] actor.act() is called with BrainAtom')
    then('throws BadRequestError')
    then('error message indicates .act() requires BrainRepl')

given('[caseN+1] genActor with mixed brains [BrainAtom, BrainRepl]')
  when('[t0] actor.ask() is called')
    then('uses first brain (BrainAtom)')
  when('[t1] actor.act({ brain: BrainRepl }) is called')
    then('uses specified BrainRepl')
    then('succeeds')
```

**verification**:
```sh
npm run test:unit -- genActor.test.ts
# expect: all tests pass including new BrainAtom cases
```

---

### phase 3: rhachet-brain-xai package

**depends on**: phase 2 (genActor must accept ActorBrain[])

#### step 3.1: create package structure

- [ ] create `src/_topublish/rhachet-brain-xai/` directory
- [ ] create `src/_topublish/rhachet-brain-xai/src/` directory
- [ ] create `src/_topublish/rhachet-brain-xai/src/atoms/` directory
- [ ] create `package.json` with appropriate dependencies
- [ ] create `tsconfig.json` extending root config

**acceptance criteria**:
```
given('package structure created')
  when('directory is inspected')
    then('src/_topublish/rhachet-brain-xai/ exists')
    then('src/_topublish/rhachet-brain-xai/src/atoms/ exists')
    then('package.json exists')
    then('tsconfig.json exists')
```

**verification**:
```sh
ls -la src/_topublish/rhachet-brain-xai/
ls -la src/_topublish/rhachet-brain-xai/src/atoms/
# expect: directories and files exist
```

---

#### step 3.2: implement genBrainAtom factory

- [ ] create `src/_topublish/rhachet-brain-xai/src/atoms/genBrainAtom.ts`
- [ ] implement XAIAtomSlug type
- [ ] implement CONFIG_BY_SLUG mapping
- [ ] implement genBrainAtom factory using OpenAI SDK with xAI baseURL

**acceptance criteria**:
```
given('genBrainAtom factory implemented')
  when('genBrainAtom({ slug: "xai/grok-code-fast-1" }) is called')
    then('returns BrainAtom instance')
    then('atom.repo is "xai"')
    then('atom.slug is "xai/grok-code-fast-1"')
    then('atom.description is defined')
    then('atom.ask is a function')
```

**verification**:
```sh
npm run test:types
# expect: no type errors
```

---

#### step 3.3: implement package index

- [ ] create `src/_topublish/rhachet-brain-xai/src/index.ts`
- [ ] export `genBrainAtom` from atoms
- [ ] export `getBrainAtomsByXAI` function

**acceptance criteria**:
```
given('package index implemented')
  when('getBrainAtomsByXAI() is called')
    then('returns array with one atom')
    then('atom is BrainAtom instance')
  when('genBrainAtom is imported')
    then('factory is available')
```

**verification**:
```sh
npm run test:types
# expect: no type errors
```

---

#### step 3.4: add genBrainAtom integration tests

- [ ] create `src/_topublish/rhachet-brain-xai/src/atoms/genBrainAtom.integration.test.ts`
- [ ] add API key guard at top of file
- [ ] add test for atom properties
- [ ] add test for .ask() with simple prompt
- [ ] add test for .ask() with briefs

**acceptance criteria**:
```
given('[case1] genBrainAtom({ slug: "xai/grok-code-fast-1" })')
  when('[t0] inspecting the atom')
    then('repo is "xai"')
    then('slug is "xai/grok-code-fast-1"')
    then('description is defined')

given('[case2] brainAtom.ask() is called')
  when('[t0] with simple prompt')
    then('returns substantive response')
    then('response.content is string')
  when('[t1] with briefs containing secret code')
    then('response leverages knowledge from brief')
```

**verification**:
```sh
XAI_API_KEY=$XAI_API_KEY npm run test:integration -- genBrainAtom.integration.test.ts
# expect: all tests pass
```

---

#### step 3.5: add package index integration tests

- [ ] create `src/_topublish/rhachet-brain-xai/src/index.integration.test.ts`
- [ ] add test for getBrainAtomsByXAI
- [ ] add test for genBrainAtom factory export

**acceptance criteria**:
```
given('[case1] getBrainAtomsByXAI')
  when('[t0] called')
    then('returns array with one atom')
    then('atom is BrainAtom instance')

given('[case2] genBrainAtom factory')
  when('[t0] called with xai/grok-code-fast-1 slug')
    then('returns BrainAtom instance')
    then('has correct slug')
```

**verification**:
```sh
XAI_API_KEY=$XAI_API_KEY npm run test:integration -- rhachet-brain-xai
# expect: all tests pass
```

---

### phase 4: demo integration test ("sunshine ocean surfer turtles")

**depends on**: phase 3 (rhachet-brain-xai must be implemented)

#### step 4.1: create demo integration test

- [ ] create `src/contract/sdk/genActor.brain.caseAskable.integration.test.ts`
- [ ] add API key guard for XAI_API_KEY
- [ ] create author actor with both BrainAtom and BrainRepl in brains[]
- [ ] add test for actor.ask() with BrainAtom
- [ ] add test for actor.ask() with BrainRepl

**acceptance criteria**:
```
given('[case1] actor with brains: [BrainAtom, BrainRepl]')
  when('[t0] author.ask({ brain: brainAtom, prompt: "...turtles..." })')
    then('returns { response: string }')
    then('response.length > 50')
    then('response contains turtle/ocean/sun/surf content')
  when('[t1] author.ask({ brain: brainRepl, prompt: "...turtles..." })')
    then('returns { response: string }')
    then('response.length > 50')
    then('response contains turtle/ocean/sun/surf content')
```

**verification**:
```sh
XAI_API_KEY=$XAI_API_KEY OPENAI_API_KEY=$OPENAI_API_KEY npm run test:integration -- genActor.brain.caseAskable.integration.test.ts
# expect: all tests pass, prose about turtles returned
```

---

### phase 5: final verification

**depends on**: all previous phases

#### step 5.1: run full type check

- [ ] verify no type errors across entire codebase

**verification**:
```sh
npm run test:types
# expect: exit 0, no errors
```

---

#### step 5.2: run full unit test suite

- [ ] verify all unit tests pass

**verification**:
```sh
npm run test:unit
# expect: all tests pass
```

---

#### step 5.3: run full integration test suite

- [ ] verify all integration tests pass

**verification**:
```sh
XAI_API_KEY=$XAI_API_KEY OPENAI_API_KEY=$OPENAI_API_KEY npm run test:integration
# expect: all tests pass
```

---

#### step 5.4: verify wish fulfillment

- [ ] usecase.1: actor.ask() with BrainAtom returns { response: string }
- [ ] usecase.2: actor.ask() with BrainRepl unchanged
- [ ] usecase.3: genActor accepts mixed brain types
- [ ] usecase.4: xAI brain atom creation works
- [ ] usecase.5: prose demo test passes ("sunshine ocean surfer turtles")

**acceptance criteria**:
```
given('all phases complete')
  when('wish fulfillment is verified')
    then('actor.ask() works with BrainAtom')
    then('actor.ask() works with BrainRepl')
    then('genActor accepts [BrainAtom, BrainRepl]')
    then('genBrainAtom({ slug: "xai/grok-code-fast-1" }) returns BrainAtom')
    then('integration test proves prose about turtles')
```

---

## dependency graph

```
phase 0: ActorBrain type + Actor extension
    │
    ▼
phase 1: actorAsk operation extension
    │
    ▼
phase 2: genActor operation extension
    │
    ▼
phase 3: rhachet-brain-xai package
    │
    ▼
phase 4: demo integration test
    │
    ▼
phase 5: final verification
```

---

## environment requirements

| variable | required for | description |
|----------|--------------|-------------|
| `XAI_API_KEY` | phase 3, 4, 5 | xAI API authentication token |
| `OPENAI_API_KEY` | phase 4, 5 | OpenAI API authentication (for BrainRepl comparison) |

---

## progress summary

| phase | steps | status |
|-------|-------|--------|
| 0 | 0.1, 0.2 | pending |
| 1 | 1.1, 1.2 | pending |
| 2 | 2.1, 2.2, 2.3 | pending |
| 3 | 3.1, 3.2, 3.3, 3.4, 3.5 | pending |
| 4 | 4.1 | pending |
| 5 | 5.1, 5.2, 5.3, 5.4 | pending |

**total steps**: 14
**total phases**: 6
