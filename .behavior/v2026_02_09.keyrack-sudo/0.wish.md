wish =

we want to support sudo grain credentials via keyrack

specifically, we dont want them enumerated in the keyrack.yml

instead, they should be enumerated on the user's keyrack.host.yml only

---

as part of that, we should upgrade the user's keyrack.host.yml to be itself encrypted via .age

so that whenever a user needs to source keys that aren't already unlocked in the daeomon, they need to first unlock their secure keyrack.host.yml.age to get an in-memory snapshot of keyrack.host.yml

that way, even they keyrack.host.yml doesn't leak information about the all the creds that are available on a machine

---

then, users should be able to set and get creds like normal per --env and --org


e.g.,


they'd set their RHELEASE_APP_GITHUB_TOKEN into the keyrack as 

rhx keyrack set ... --org @this --env all 

---

for sudo keys

they would say


rhx keyrack set ... --org @this --env sudo

and that sudo key would then NOT get enumerated in keyrack.yml

instead, it would only be available on the host

---

the usecase is

lets say project X needs to install a new github app against their github org; the human needs to supply a github account's sudo creds in order to create it

in that case, we dont want to expose those creds anywhere or even mention that they exist in any plaintext file

instead, 

rhx keyrack set --org @this --env sudo --key EHMPATHY_ORG_MANAGER_GITHUB_TOKEN --vault 1password 

then, keyrack would alk them through the setup process

and only put taht key into the keyrack.host.yml.age 



---

and to unlock

                        
                                                                                                                              
  it'll be                                                                                                                    
                                                                                                                              
  npx rhachet unlock --env sudo --key $x                                                                                      
                                                                                                                              
  for sudo env, they must unlock each key one at a time, before they can use it; prevents over-exposure  


with a default expiration of 30min



----


update; we realized that in order to support an encrpyted manifest to protect sudo key against discovery, we need to support an encrypted manifest, and to do that right, we need to support recipient based encryption for the manifest

we'll apply that to both the manifest and os.secure, per age's philosophy

here are the details: .behavior/v2026_02_09.keyrack-sudo/.refs/vision.recipient-key-based-locks.ref.md

critical to adhere to .behavior/v2026_02_09.keyrack-sudo/.refs/vision.recipient-key-based-locks.ref.md
