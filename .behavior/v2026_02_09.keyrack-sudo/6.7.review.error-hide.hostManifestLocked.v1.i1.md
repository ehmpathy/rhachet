# plan: remove hostManifestLocked (error-hide removal)

## explanation

`genKeyrackGrantContext.ts` has a try/catch around manifest decryption (lines 53-72). when decryption fails, it:
1. swallows the error
2. creates a fake empty manifest
3. sets `hostManifestLocked = true` to remember it lied

this is an error-hide pattern — the codebase explicitly forbids it (`rule.forbid.error-hide`). failed decryption is a fail-fast failure state, not a silent recovery.

the `hostManifestLocked` flag exists solely to undo the lie downstream: `getKeyrackKeyGrant.ts:198` checks it to return `status: 'locked'` instead of `status: 'absent'`. but this distinction only matters because the manifest was faked — if decryption fails, the caller should never reach `getKeyrackKeyGrant` with a fake manifest in the first place.

notably:
- zero tests ever set `hostManifestLocked: true` — the "locked" branch at line 198 has no coverage
- `status: 'locked'` in `KeyrackGrantAttempt` is still legitimate for two other cases (sudo key absent from daemon cache at line 170, vault locked at line 229) — those stay
- the CLI handler for `status: 'locked'` (invokeKeyrack.ts:393) stays — it renders those other locked cases

## steps

### step 1: remove try/catch error-hide in genKeyrackGrantContext.ts

remove the try/catch block (lines 53-72). let `daoKeyrackHostManifest.get()` failures propagate to the caller. the code becomes:

```ts
const hostManifest =
  (await daoKeyrackHostManifest.get({ owner, prikey })) ??
  new KeyrackHostManifest({
    uri: `~/.rhachet/keyrack/keyrack.host${owner ? `.${owner}` : ''}.age`,
    owner,
    recipients: [],
    hosts: {},
  });
```

the null coalesce `??` still handles "manifest file absent" (dao returns null). only decryption *failures* (throws) propagate — which is the correct fail-fast behavior.

### step 2: remove hostManifestLocked from KeyrackGrantContext interface

in `genKeyrackGrantContext.ts`:
- remove `hostManifestLocked: boolean` from the interface (line 29)
- remove the `let hostManifestLocked = false` variable (line 52)
- remove `hostManifestLocked` from the return object (line 115)

### step 3: remove hostManifestLocked branch in getKeyrackKeyGrant.ts

remove the `if (context.hostManifestLocked && keySpec)` block at lines 196-205. the `status: 'absent'` return at line 207 already handles key-not-found correctly.

the two other `status: 'locked'` returns (line 170: sudo key absent from daemon, line 229: vault locked) are unrelated and stay.

### step 4: remove hostManifestLocked from all test files

revert the `hostManifestLocked: false` additions from this and the prior session:
- `getKeyrackKeyGrant.test.ts`: 8 occurrences
- `unlockKeyrack.test.ts`: 6 occurrences
- `unlockKeyrack.integration.test.ts`: 4 occurrences (the 3 left were never added)

### step 5: verify

run `npm run test:types` to confirm zero type errors.
