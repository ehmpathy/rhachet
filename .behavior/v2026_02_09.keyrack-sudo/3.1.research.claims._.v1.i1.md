# research: claims for keyrack sudo

## 1. credential TTL and exposure window

### [FACT] short-lived credentials reduce attack surface

> "Short-lived (ephemeral) credentials are dynamic secrets that automatically expire after a brief, predefined period — typically minutes or hours." [1]

> "During creation, a background task is initiated to clean up the credential after some predefined amount of time (this lifespan of the dynamic secret is called 'time to live' or TTL)." [1]

### [FACT] industry fails at credential rotation

> "Industry studies report that 71% of organizations fail to rotate secrets within recommended intervals, and 73% of secrets vaults contain misconfigurations that could lead to breaches." [1]

### [SUMP] 30min is appropriate for elevated credentials

our vision proposes 30min TTL for sudo credentials. this is an assumption based on:
- short enough to limit exposure window
- long enough for typical administrative tasks (terraform apply, etc)

### [KHUE] what is the optimal TTL for sudo credentials?

should we allow users to configure? or enforce a maximum cap?

---

## 2. privilege escalation and sudo semantics

### [FACT] sudo credential caching creates attack vectors

> "Sudo has a timestamp_timeout configuration feature that determines how long in minutes can pass between sudo instances before it will re-prompt for a password, because sudo can cache credentials for a period of time." [2]

> "Adversaries can monitor the /var/db/sudo timestamp to see if it falls within the timestamp_timeout range, and if it does, malware can execute sudo commands without needing to supply the user's password." [2]

### [OPIN] time-bound access is best practice for elevated privileges

> "Security best practices recommend implementing time-bound access for roles needing temporary privileges, and automating privilege expiration to ensure users revert to their baseline access levels after the task, minimizing prolonged exposure to elevated privileges." [2]

---

## 3. age encryption security

### [FACT] age uses modern cryptographic primitives

> "Age uses a selection of algorithms that make it a highly secure way of encrypting files, including the ECDH curve X25519, HMAC-SHA256 and ChaCha20-Poly1305." [3]

### [FACT] age provides authentication

> "Age is already authenticated, sort of. You can't produce an age file that will decrypt with a given identity if you don't know its recipient." [4]

### [KHUE] has age received formal security audit?

from research: "The search results don't contain information about a formal independent security audit or cryptographic review of age by external parties." [3]

this is worth further investigation before production use.

### [OPIN] age was designed to replace GPG for file encryption

> "Age is a file encryption format, tool, and library. It was made to replace one of the last remaining GnuPG use cases." [3]

---

## 4. CI environment security

### [FACT] GitHub Actions encrypts secrets client-side

> "Secrets use Libsodium sealed boxes so that they are encrypted before reaching GitHub, occurring when the secret is submitted using the UI or through the REST API." [5]

### [FACT] GitHub Actions masks secrets in logs

> "When workflows run, GitHub automatically masks any secrets that accidentally get printed to the logs, providing an additional layer of protection against accidental exposure." [5]

### [OPIN] elevated credentials should not exist in CI

> "When generating credentials, grant the minimum permissions possible... consider granting read-only permissions if that's all that is needed." [5]

our vision blocks sudo credentials in CI — this aligns with principle of least privilege.

### [SUMP] CI detection via environment variables is reliable

we assume `CI=true` and `GITHUB_ACTIONS` env vars reliably indicate CI environment. this is standard practice but could be spoofed by malicious actors with local access.

---

## 5. rate limiting for brute force protection

### [FACT] exponential backoff defeats brute force mathematically

> "For every failed attempt, increase the time the server takes to respond (Exponential Backoff). This makes brute-forcing mathematically impossible by turning a 1-second command into a 10-year project for the attacker." [6]

### [OPIN] exponential backoff is preferred over account lockout

> "Enforce rate limiting on login attempts, preventing rapid successive requests from the same IP address or user account. Implement exponential backoff strategies to increase delay after each unsuccessful attempt." [6]

account lockout creates DoS vector; exponential backoff does not.

### [SUMP] our proposed backoff schedule is sufficient

our vision proposes: 0s, 1s, 2s, 4s, 8s (capped). this is an assumption — no specific research validates these exact values.

---

## 6. unix socket security

### [FACT] socket file permissions control access

socket permissions are controlled by filesystem permissions. set `0600` to restrict access to owner only.

### [KHUE] should we verify caller UID matches socket owner?

beyond file permissions, we could verify the connected process UID. is this defense-in-depth worth the complexity?

---

## 7. passphrase handling

### [FACT] shell history is a common credential leak vector

command-line arguments are visible in process listings and may be logged to shell history files (`.bash_history`, `.zsh_history`).

### [OPIN] interactive prompts are safer than CLI arguments

our vision blocks `--passphrase` arg for sudo credentials, requires interactive prompt or env var. this aligns with security best practices.

### [KHUE] should we support stdin for passphrase input?

`echo $PASS | command` is safer than `command --pass=$PASS` but still visible in process listing. is stdin a good middle ground?

---

## summary of open questions

| id | question | impact |
|----|----------|--------|
| KHUE-1 | optimal TTL for sudo credentials? | affects exposure window |
| KHUE-2 | has age received formal security audit? | affects trust in encryption |
| KHUE-3 | verify caller UID beyond socket permissions? | affects defense depth |
| KHUE-4 | support stdin for passphrase input? | affects automation ux |

---

## citations

1. [HashiCorp - Why we need short-lived credentials](https://www.hashicorp.com/en/blog/why-we-need-short-lived-credentials-and-how-to-adopt-them)
2. [MITRE ATT&CK - Sudo and Sudo Caching](https://attack.mitre.org/techniques/T1548/003/)
3. [FiloSottile/age - GitHub](https://github.com/FiloSottile/age)
4. [Filippo Valsorda - age and Authenticated Encryption](https://words.filippo.io/age-authentication/)
5. [GitHub Docs - Secrets](https://docs.github.com/en/actions/concepts/security/secrets)
6. [HackerNoon - Rate Limiting and Brute Force Prevention](https://hackernoon.com/defending-your-web-app-a-guide-to-rate-limiting-and-brute-force-attack-prevention)
