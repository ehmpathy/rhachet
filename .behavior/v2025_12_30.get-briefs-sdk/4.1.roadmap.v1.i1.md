# roadmap: `getRoleBriefs` SDK procedure

## step 1: create `getRoleBriefs` domain operation

- [ ] create `src/domain.operations/role/getRoleBriefs.ts`

**acceptance criteria**:
- exposes `getRoleBriefs(input: { by: { role, repo?, briefs } })` async function
- scans `.agent/repo=*/role=*/` directories for matching role name
- filters by `repo.name` when provided
- throws when no matching role found (with `did you forget to npx rhachet roles link` hint)
- throws when multiple roles match without repo filter
- throws when briefs directory missing (with link hint)
- matches briefs by `name[]` (exact) or `glob` (pattern)
- returns `Artifact<typeof GitFile>[]` via `genArtifactGitFile`
- includes jsdoc with `.note` about `.agent/*` and link reminder

**acceptance verification**:
```sh
npx tsc --noEmit
# expect: no type errors
```

---

## step 2: create test fixtures

- [ ] ensure `.agent/` test fixture exists with linked role and briefs

**depends on**: step 1

**acceptance criteria**:
- test fixture role exists at `.agent/repo=$repo/role=$role/briefs/`
- contains at least 2 brief files for glob matching tests
- supports disambiguation test (multiple roles with same name across repos)

**acceptance verification**:
```sh
ls -la .agent/
# expect: repo=* directories with role=* subdirectories containing briefs/
```

---

## step 3: create unit tests

- [ ] create `src/domain.operations/role/getRoleBriefs.test.ts`

**depends on**: step 1, step 2

**acceptance criteria**:
- [case1] role linked with briefs
  - [t0] getRoleBriefs with role name and brief names → returns artifacts
  - [t1] getRoleBriefs with glob pattern → returns matching artifacts
  - [t2] getRoleBriefs with glob matching nothing → returns empty array
- [case2] multiple roles with same name
  - [t0] getRoleBriefs without repo filter → throws ambiguous error
  - [t1] getRoleBriefs with repo filter → returns briefs from specified repo
- [case3] role not found
  - [t0] getRoleBriefs with nonexistent role → throws with link hint
- [case4] briefs directory missing
  - [t0] getRoleBriefs → throws with link hint
- [case5] brief name not found
  - [t0] getRoleBriefs with nonexistent brief name → throws brief not found

**acceptance verification**:
```sh
npx jest src/domain.operations/role/getRoleBriefs.test.ts
# expect: all tests pass
```

---

## step 4: export from SDK

- [ ] modify `src/contract/sdk.ts` to export `getRoleBriefs`

**depends on**: step 3

**acceptance criteria**:
- `getRoleBriefs` is exported from `rhachet` package
- consumers can import via `import { getRoleBriefs } from 'rhachet'`

**acceptance verification**:
```sh
npx tsc --noEmit
# expect: no type errors

grep -q "getRoleBriefs" src/contract/sdk.ts
# expect: exit 0 (found)
```

---

## step 5: verify full build

- [ ] run full build and test suite

**depends on**: step 4

**acceptance criteria**:
- typescript compiles without errors
- all existing tests pass
- all new tests pass
- lint passes

**acceptance verification**:
```sh
npm run build && npm run test
# expect: build succeeds, all tests pass
```

---

## step 6: verify blackbox criteria

- [ ] manually verify all 5 blackbox usecases

**depends on**: step 5

**acceptance criteria**:
- usecase.1: get briefs by name for linked role ✓
- usecase.2: disambiguate roles with same name across registries ✓
- usecase.3: handle missing or unlinked roles ✓
- usecase.4: handle missing briefs ✓
- usecase.5: compose roles using briefs from other roles ✓

**acceptance verification**:
```ts
// manual verification in repl or test file
import { getRoleBriefs } from 'rhachet';

// usecase.1: get briefs by name
const briefs = await getRoleBriefs({
  by: { role: { name: 'behaver' }, briefs: { glob: 'measure/*' } },
});
console.log(briefs); // expect: Artifact<typeof GitFile>[]

// usecase.2: disambiguation
const briefsSpecific = await getRoleBriefs({
  by: { repo: { name: 'bhuild' }, role: { name: 'behaver' }, briefs: { glob: '*' } },
});
console.log(briefsSpecific); // expect: briefs from bhuild repo only

// usecase.3: missing role
await getRoleBriefs({
  by: { role: { name: 'nonexistent' }, briefs: { glob: '*' } },
}); // expect: throws with "did you forget to npx rhachet roles link" hint

// usecase.4: missing brief
await getRoleBriefs({
  by: { role: { name: 'behaver' }, briefs: { name: ['nonexistent'] } },
}); // expect: throws brief not found

// usecase.5: artifacts are lazy-loadable
const artifacts = await getRoleBriefs({
  by: { role: { name: 'behaver' }, briefs: { glob: '*' } },
});
const content = await artifacts[0].get(); // expect: loads content on demand
```

---

## summary

| step | file | action |
|------|------|--------|
| 1 | `src/domain.operations/role/getRoleBriefs.ts` | create |
| 2 | `.agent/` fixtures | verify/create |
| 3 | `src/domain.operations/role/getRoleBriefs.test.ts` | create |
| 4 | `src/contract/sdk.ts` | modify |
| 5 | - | build & test |
| 6 | - | blackbox verification |
