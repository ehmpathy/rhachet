# blackbox coverage matrix: briefs compression

## matrix 1: boot brief resolution

usecases covered: 1, 2, 4

dimensions:
- ind: `.min` exists — whether a `.md.min` counterpart is present
- ind: `.md` exists — whether the `.md` source is present
- ind: in blocklist dir — whether the file is in `.scratch/` or `.archive/`
- dep: file loaded — which file the loader reads
- dep: boot result — whether boot succeeds or fails fast

| ind: `.min` exists | ind: `.md` exists | ind: in blocklist dir | dep: file loaded | dep: boot result |
|---------------------|-------------------|-----------------------|------------------|------------------|
| yes | yes | no | `.min` | success |
| no | yes | no | `.md` | success |
| yes | no | no | — | failfast (orphan `.min`) |
| no | no | no | — | n/a (no file to discover) |
| yes | yes | yes | — | excluded (blocklist) |
| no | yes | yes | — | excluded (blocklist) |
| yes | no | yes | — | excluded (blocklist) |

notes:
- row 1 = primary compression path (usecase 1)
- row 2 = backwards compat fallback (usecase 1)
- row 3 = orphan failfast (usecase 2) — enforced on both `roles boot` and `rhachet repo introspect`
- rows 5-7 = blocklist exclusion applies to both extensions (usecase 4)

## matrix 2: orphan `.min` detection surface

usecase covered: 2

dimensions:
- ind: command — which command is invoked
- dep: orphan detected — whether orphan `.min` without `.md` causes failfast

| ind: command | dep: orphan detected |
|---|---|
| `roles boot` | failfast with error that names the orphan file |
| `rhachet repo introspect` | failfast with error that names the orphan file |

notes:
- both surfaces enforce the same invariant: `.min` is derived, source `.md` must exist
- no soft detection, no warnings — hard fail at both layers

## matrix 3: `briefs compress` command

usecase covered: 3

dimensions:
- ind: `.min` counterpart pre-exists — whether a prior `.min` file is present
- dep: `.min` produced — whether a `.min` file is written
- dep: `.md` modified — whether the source `.md` is altered
- dep: token reduction — whether `.min` has fewer tokens than `.md`

| ind: `.min` pre-exists | dep: `.min` produced | dep: `.md` modified | dep: token reduction |
|-------------------------|-----------------------|---------------------|----------------------|
| no | yes (created) | no | yes |
| yes | yes (regenerated) | no | yes |

notes:
- both rows produce the same outcome — idempotent regeneration
- source `.md` is never modified by compression
- token reduction is a required invariant, not best-effort

## matrix 4: boot output format

usecases covered: 1, 5

dimensions:
- ind: compression state — whether the brief loaded from `.min` or `.md`
- dep: `<brief path>` value — what path appears in the xml tag
- dep: stats tokens — what the token count reflects

| ind: compression state | dep: `<brief path>` value | dep: stats tokens |
|------------------------|---------------------------|-------------------|
| loaded from `.min` | `.md` path (not `.min`) | tokens of `.min` content |
| loaded from `.md` | `.md` path | tokens of `.md` content |

notes:
- brief path identity is always the `.md` path — stable regardless of compression
- stats reflect actual loaded content — compressed when available

## gap analysis

no gaps detected. all meaningful combinations are covered by the blackbox criteria.

## decomposition analysis

no decomposition needed. each matrix has 2-3 independent dimensions — well within the manageable range. concerns are cleanly separated across the 4 matrices.
