# execution: keyrack os.envvar vault + ci action firewall

> progress tracker for blueprint v2 implementation

---

## phase 0: domain objects

- [x] add 'os.envvar' to KeyrackHostVault union type

## phase 1: vault adapter

- [x] create vaultAdapterOsEnvvar.ts
- [x] create vaultAdapterOsEnvvar.test.ts (unit tests)
- [x] export from adapters/vaults/index.ts

## phase 2: grant context

- [x] add os.envvar adapter to vaultAdapters in genKeyrackGrantContext.ts
- [x] add os.envvar adapter to vaultAdapters in genKeyrackHostContext.ts

## phase 3: grant flow

- [x] update attemptGrantKey to check os.envvar first (before host manifest lookup)
- [x] add unit tests for os.envvar priority (case6, case7, case8)

## phase 4: integration tests

- [x] extend getKeyrackKeyGrant.integration.test.ts for os.envvar scenarios (case6, case7)
- [x] fix test key names to avoid conflicts with real env vars

## phase 5: acceptance tests

- [ ] extend keyrack acceptance tests for CI firewall scenario

## phase 6: ci action

- [ ] rewrite .github/actions/keyrack/action.yml as firewall

## phase 7: verification

- [ ] npm run test:types
- [ ] npm run test:unit
- [ ] npm run test:integration
- [ ] npm run build

---

## progress log

### 2026-02-06

- phases 0-3 complete
- 78 keyrack unit tests pass
- types compile
- os.envvar priority verified: env checked first, takes precedence over host manifest
