wish =

when keys cant be got (absent, locked, etc)

then keyrack should exit code = 2 -> blocked by constraints

---

see below for the handoff



---

                           
● Handoff Brief: keyrack integration for git.commit.push                                                                                    
                                                                                                                                            
  Goal                                                                                                                                      
                                                                      
  Integrate keyrack into git.commit.push.sh so mechanics never have to say "I don't have auth" — the skill should auto-fetch tokens         
  invisibly with fail-fast errors.                                    

  What's Done

  1. keyrack.yml — added EHMPATHY_SEATURTLE_PROD_GITHUB_TOKEN to env.all
  2. git.commit.push.sh — replaced token guard with keyrack fetch + auto-unlock fallback:
    - Try default owner keyrack get
    - If fails, auto-unlock ehmpath.demo then get from it
    - If both fail, show only first error (suppress fallback noise)
  3. Tests — 13/15 passing
    - Happy paths work (case1-11, case13-14)
    - Sad paths fail (case12, case15)

  Blocker: keyrack get exits 0 when locked

  $ npx rhachet keyrack get --key EHMPATHY_SEATURTLE_PROD_GITHUB_TOKEN --owner ehmpath.demo --json
  {"status": "locked", ...}  # exit code: 0 ← should be non-zero!

  The bash script uses if RESULT=$(...keyrack get...); then which checks exit code. When keyrack returns "locked" with exit 0, the script
  thinks it succeeded.

  Fix Required in rhachet

  keyrack get should exit non-zero when:
  - Key is locked
  - Key not found
  - Any error condition

  Only exit 0 when the actual credential value is returned.

  Files Changed

  - src/domain.roles/mechanic/keyrack.yml
  - src/domain.roles/mechanic/skills/git.commit/git.commit.push.sh (lines 158-182)
  - src/domain.roles/mechanic/skills/git.commit/git.commit.push.integration.test.ts
  - .behavior/v2026_02_24.mechanic-keyrack/3.3.blueprint.v1.i1.md
  - .behavior/v2026_02_24.mechanic-keyrack/5.1.execution.phase0_to_phaseN.v1.i1.md

  Next Steps

  1. Fix keyrack get exit code in rhachet
  2. Re-run tests — case12 and case15 should pass
  3. Update snapshots
  4. Commit


