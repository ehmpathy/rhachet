# research: oss levers for keyrack --owner

## summary

this feature is primarily an internal refactor. no new oss dependencies needed.

the work involves:
1. thread `owner` parameter through extant codepaths
2. standardize cli flags (`--for` → `--owner`)
3. namespace vault storage paths with `owner={owner}/` directories

all required capabilities are already present in the codebase.

---

## extant oss dependencies (already in use)

### commander.js — cli flag parse

**used for:** `--owner` and `--for` flag definitions

```typescript
.option('--owner <owner>', 'owner identity (e.g., mechanic, foreman)')
.option('--for <owner>', 'alias for --owner (deprecated)')
```

**status:** already used throughout `invokeKeyrack.ts`. no changes to dependency needed.

### node.js fs — file system operations

**used for:** create `owner={owner}/` directories, read/write vault files

```typescript
mkdirSync(join(vaultDir, `owner=${owner ?? 'default'}`), { recursive: true });
```

**status:** standard node.js. no external dependency.

### age-encryption — secret storage

**used for:** encrypt/decrypt per-owner vault entries in os.secure

**status:** already used. no changes to dependency needed.

---

## internal pattern reuse

### key=value/ directory namespace pattern

**source:** `.agent/repo=.this/role=any/` directory structure

**application:** vault storage paths

```
os.direct/owner=default/keyrack.direct.json
os.direct/owner=ehmpath.demo/keyrack.direct.json
```

this pattern is already established in rhachet for role/repo namespace. we reuse the same convention for vault owner namespace.

---

## conclusion

| category | oss tool | action |
|----------|----------|--------|
| cli flags | commander.js | no change |
| file system | node.js fs | no change |
| encryption | age-encryption | no change |
| directory pattern | internal | reuse `key=value/` convention |

no new oss dependencies. the feature is self-contained within extant codebase patterns.
