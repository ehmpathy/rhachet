# self-review gap report: all-done-self

**stone:** 3.3.blueprint.v1
**date:** 2026-02-26

---

## gap.1 = daemon access owner path absent from filediff

**issue:** the filediff says `vaultAdapterOsDaemon.ts` is `[○] retain` but lacks the daemon SDK files that need owner parameter.

**analysis:**
- the vault adapter itself is fine (it delegates to daemon SDK)
- but `daemonAccessGet.ts`, `daemonAccessUnlock.ts`, etc. need to accept owner parameter
- these need to pass owner to `getKeyrackDaemonSocketPath({ owner })`

**fix:** add daemon SDK files to filediff:
```
domain.operations/keyrack/daemon/sdk/src/domain.operations/
  [~] daemonAccessGet.ts           # add owner parameter
  [~] daemonAccessUnlock.ts        # add owner parameter
  [~] daemonAccessRelock.ts        # add owner parameter
  [~] daemonAccessStatus.ts        # add owner parameter
```

---

## gap.2 = genContextKeyrackGrantGet codepath is underspecified

**issue:** the blueprint says "thread owner to vault adapters" but this context has no vault adapters. the actual path needed is different.

**analysis:**
- `genContextKeyrackGrantGet` returns `{ repoManifest, envvarAdapter, mechAdapters }`
- no os.direct/os.secure adapters — those are in `genKeyrackHostContext`
- owner needs to be stored in context and passed to `daemonAccessGet`

**fix:** update codepath to show actual path:
```
genContextKeyrackGrantGet.ts
  ├─ [~] add owner parameter to input
  └─ [~] include owner in returned context (for daemon access)

getKeyrackKeyGrant.ts
  └─ [~] pass context.owner to daemonAccessGet
```

---

## gap.3 = error tip message absent from codepath

**issue:** criteria says error should include "run keyrack init --owner X first" but this isn't shown in codepath treestruct.

**analysis:**
- `genKeyrackHostContext.ts` throws error with message "run: rhx keyrack init"
- needs to include `--owner {owner}` when owner is not null

**fix:** add to codepath:
```
genKeyrackHostContext.ts
  └─ [~] update error message to include --owner flag when owner is set
```

---

## status

**gaps found:** 3
**severity:** all are clarification/completeness gaps, no fundamental design issues
**action:** update blueprint to address these gaps
