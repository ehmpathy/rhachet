# blackbox criteria: keyrack init --owner

## usecase.1 = init custom owner

```
given(no host manifest exists for owner 'ehmpath.demo')
  when(user runs 'keyrack init --owner ehmpath.demo')
    then(host manifest is created at ~/.rhachet/keyrack/keyrack.host.ehmpath.demo.age)
      sothat(user can store keys for this owner)
    then(output shows 'freshly minted' with owner 'ehmpath.demo')
      sothat(user knows the manifest was created)

given(host manifest already exists for owner 'ehmpath.demo')
  when(user runs 'keyrack init --owner ehmpath.demo')
    then(output shows 'found' with owner 'ehmpath.demo')
      sothat(user knows the manifest already existed)
    then(manifest is not modified)
      sothat(prior keys are preserved)
```

## usecase.2 = set key with custom owner

```
given(host manifest exists for owner 'ehmpath.demo')
  when(user runs 'keyrack set --key DEMO_TOKEN --vault os.direct --owner ehmpath.demo --org @all')
    then(key is stored in vault path os.direct/owner=ehmpath.demo/keyrack.direct.json)
      sothat(key is isolated from default owner)
    then(output shows key was set for owner 'ehmpath.demo')
      sothat(user knows which owner received the key)

given(no host manifest exists for owner 'ehmpath.demo')
  when(user runs 'keyrack set --key DEMO_TOKEN --vault os.direct --owner ehmpath.demo --org @all')
    then(error indicates host manifest not found for owner 'ehmpath.demo')
    then(error includes tip: 'run keyrack init --owner ehmpath.demo first')
      sothat(user catches owner typos and knows how to fix)
```

## usecase.3 = get key with custom owner

```
given(key 'DEMO_TOKEN' exists for owner 'ehmpath.demo' in vault 'os.direct')
  when(user runs 'keyrack get --key DEMO_TOKEN --owner ehmpath.demo --org @all')
    then(key value is returned)
      sothat(user can use the key)

given(key 'DEMO_TOKEN' exists for owner 'ehmpath.demo' but NOT for default owner)
  when(user runs 'keyrack get --key DEMO_TOKEN --org @all' without --owner)
    then(key is not found)
      sothat(default owner is isolated from demo owner)

given(key 'DEMO_TOKEN' exists for default owner but NOT for 'ehmpath.demo')
  when(user runs 'keyrack get --key DEMO_TOKEN --owner ehmpath.demo --org @all')
    then(key is not found)
      sothat(demo owner is isolated from default owner)
```

## usecase.4 = vault isolation per owner

```
given(key 'API_KEY' set for default owner in vault 'os.direct')
  and(key 'API_KEY' set for owner 'ehmpath.demo' in vault 'os.direct' with different value)
  when(user runs 'keyrack get --key API_KEY --org @all')
    then(value from default owner is returned)
  when(user runs 'keyrack get --key API_KEY --owner ehmpath.demo --org @all')
    then(value from ehmpath.demo owner is returned)
      sothat(owners are fully isolated even for same key name)

given(key 'API_KEY' set for default owner in vault 'os.secure')
  and(key 'API_KEY' set for owner 'ehmpath.demo' in vault 'os.secure' with different value)
  when(user lists vault files)
    then(default owner file exists at os.secure/owner=default/<hash>.age)
    then(demo owner file exists at os.secure/owner=ehmpath.demo/<hash>.age)
      sothat(vault files are physically separate per owner)
```

## usecase.5 = status with custom owner

```
given(keys exist for owner 'ehmpath.demo')
  when(user runs 'keyrack status --owner ehmpath.demo')
    then(status shows keys for owner 'ehmpath.demo' only)
      sothat(user can see what keys are configured for that owner)

given(keys exist for default owner and owner 'ehmpath.demo')
  when(user runs 'keyrack status' without --owner)
    then(status shows keys for default owner only)
      sothat(owners remain isolated in status view)
```

## usecase.6 = --owner flag consistency

```
given(user wants to use custom owner)
  when(user runs 'keyrack init --owner ehmpath.demo')
    then(command succeeds)
  when(user runs 'keyrack set --owner ehmpath.demo ...')
    then(command succeeds)
  when(user runs 'keyrack get --owner ehmpath.demo ...')
    then(command succeeds)
  when(user runs 'keyrack status --owner ehmpath.demo')
    then(command succeeds)
  when(user runs 'keyrack recipient set --owner ehmpath.demo ...')
    then(command succeeds)
      sothat(--owner flag is consistent across all host-manifest commands)

given(user uses --for flag as alias)
  when(user runs 'keyrack init --for ehmpath.demo')
    then(command succeeds with same behavior as --owner)
      sothat(either flag works)
```

## usecase.7 = fallback pattern

```
given(key 'GITHUB_PAT' exists for owner 'ehmpath.demo' but NOT for default owner)
  when(skill tries 'keyrack get --key GITHUB_PAT --org @all')
    then(key is not found)
  when(skill tries 'keyrack get --key GITHUB_PAT --owner ehmpath.demo --org @all')
    then(key value is returned)
      sothat(skills can implement fallback from default to demo owner)
```
