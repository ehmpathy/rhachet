# execution log: fail fast on non-executable skills publish

## status: complete ✨

---

## phase 1: core logic

### step 1.1: create `findNonExecutableShellSkills.ts`

- [x] created file at `src/domain.operations/manifest/findNonExecutableShellSkills.ts`
- [x] exports `findNonExecutableShellSkills({ registry: RoleRegistry }): string[]`
- [x] returns empty array when registry has no roles
- [x] returns empty array when skills dirs contain only non-.sh files
- [x] returns empty array when all .sh files are executable
- [x] returns array of paths when .sh files lack execute permission
- [x] handles `skills.dirs` as single object `{ uri }`
- [x] handles `skills.dirs` as array `{ uri }[]`

### step 1.2: unit tests for `findNonExecutableShellSkills`

- [x] [case1] registry with no roles → returns `[]`
- [x] [case2] role with empty skills.dirs → returns `[]`
- [x] [case3] skills dir with only .ts/.md files → returns `[]`
- [x] [case4] skills dir with executable .sh files → returns `[]`
- [x] [case5] skills dir with one non-executable .sh → returns `[path]`
- [x] [case6] mixed executable/non-executable → returns only non-executable paths
- [x] [case7] multiple roles, one with non-executable → returns that path
- [x] [case8] skills.dirs as single object → handles correctly
- [x] [case9] skills.dirs as array → handles correctly

### step 1.3: create `assertRegistrySkillsExecutable.ts`

- [x] exports `assertRegistrySkillsExecutable({ registry: RoleRegistry }): void`
- [x] completes without error when all skills are executable
- [x] throws `BadRequestError` when non-executable skills found
- [x] error message lists all non-executable paths
- [x] error metadata includes `nonExecutablePaths` array

### step 1.4: unit tests for `assertRegistrySkillsExecutable`

- [x] [case1] registry with all executable skills → no error
- [x] [case2] registry with one non-executable → BadRequestError with path in message
- [x] [case3] registry with multiple non-executable → BadRequestError with all paths

---

## phase 2: integration

### step 2.1: integrate validation into `invokeRepoIntrospect.ts`

- [x] imports `assertRegistrySkillsExecutable`
- [x] calls `assertRegistrySkillsExecutable({ registry })` after `getRoleRegistry()`
- [x] call placed before `castIntoRoleRegistryManifest()`
- [x] no changes to prior success behavior

### step 2.2: integration tests

- [x] [t11] skills dir with executable .sh → command succeeds, yml generated
- [x] [t12] skills dir with non-executable .sh → command fails, error contains path
- [x] [t13] multiple non-executable .sh → error lists ALL paths
- [x] [t14] skills dir with only .ts/.md → command succeeds
- [x] prior test cases still pass (no regression)

---

## phase 3: acceptance

### step 3.1: acceptance tests for blackbox criteria

- [x] [case3] valid package with executable skills → exit 0, yml generated
- [x] [case4] package with non-executable skill → exit non-zero, path in stderr
- [x] [case5] multiple non-executable → all paths in stderr
- [x] [case6] non-.sh files only → exit 0
- [x] prior test cases still pass (no regression)

---

## phase 4: validation

### step 4.1: full test suite pass

- [x] `npm run test:types` passes
- [x] `npm run test:lint` passes
- [x] `npm run test:unit` passes (14 tests)
- [x] `npm run test:integration` passes (29 tests)
- [x] `npm run test:acceptance` passes (188 tests)

### step 4.2: manual validation

- [x] acceptance tests cover real behavior scenarios
- [x] error message includes fix hint (`chmod +x`)

---

## completion

- [x] phase 1 complete
- [x] phase 2 complete
- [x] phase 3 complete
- [x] phase 4 complete
- [x] ready for code review

---

## files created/modified

### new files
- `src/domain.operations/manifest/findNonExecutableShellSkills.ts`
- `src/domain.operations/manifest/findNonExecutableShellSkills.test.ts`
- `src/domain.operations/manifest/assertRegistrySkillsExecutable.ts`
- `src/domain.operations/manifest/assertRegistrySkillsExecutable.test.ts`

### modified files
- `src/contract/cli/invokeRepoIntrospect.ts` - added validation call
- `src/contract/cli/invokeRepoIntrospect.integration.test.ts` - added test cases t11-t14
- `accept.blackbox/cli/repo.introspect.acceptance.test.ts` - added test cases case3-case6
