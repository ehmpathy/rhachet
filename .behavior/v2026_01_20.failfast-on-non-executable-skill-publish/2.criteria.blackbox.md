# usecase.1 = role supplier publishes package with valid skills

given('a rhachet-roles-* package with all .sh skills marked executable')
  when('user runs `npx rhachet repo introspect`')
    then('command succeeds with exit code 0')
      sothat('role supplier can publish usable packages')
    then('rhachet.repo.yml is generated')
      sothat('downstream consumers can discover and use the roles')

# usecase.2 = role supplier catches broken skills before publish

given('a rhachet-roles-* package with a .sh skill NOT marked executable')
  when('user runs `npx rhachet repo introspect`')
    then('command fails with non-zero exit code')
      sothat('broken packages are not published')
    then('error message identifies the non-executable skill by path')
      sothat('role supplier knows exactly which file to fix')
    then('rhachet.repo.yml is NOT generated')
      sothat('partial/broken output does not mislead')

# usecase.3 = role supplier catches multiple broken skills

given('a rhachet-roles-* package with multiple .sh skills NOT marked executable')
  when('user runs `npx rhachet repo introspect`')
    then('error message lists ALL non-executable skills')
      sothat('role supplier can fix all issues in one pass')

# boundary.1 = package with no skills

given('a rhachet-roles-* package with no skills directories')
  when('user runs `npx rhachet repo introspect`')
    then('command succeeds with exit code 0')
      sothat('packages without skills are valid')

# boundary.2 = skills directory with non-.sh files only

given('a rhachet-roles-* package where skills dir has only .ts or .md files')
  when('user runs `npx rhachet repo introspect`')
    then('command succeeds with exit code 0')
      sothat('non-shell skills are not falsely flagged')

# boundary.3 = mixed executable and non-executable skills

given('a rhachet-roles-* package with 3 executable .sh skills and 1 non-executable .sh skill')
  when('user runs `npx rhachet repo introspect`')
    then('command fails with non-zero exit code')
    then('error identifies only the 1 non-executable skill')
      sothat('valid skills are not falsely flagged')
