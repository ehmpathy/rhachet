# blackbox criteria: upgrade brains

experience bounds required to fulfill the wish: `npx rhachet upgrade` should upgrade `rhachet-brains-*` packages alongside `rhachet-roles-*` packages.

---

# usecase.1 = help discoverability

given('user wants to understand upgrade options')
  when('rhachet upgrade --help')
    then('stdout contains --brains option')
      sothat('user knows brains can be upgraded')
    then('stdout contains --roles option')
      sothat('current roles behavior is preserved')
    then('stdout contains --self option')
      sothat('current self behavior is preserved')

---

# usecase.2 = upgrade specific brain

given('repo with rhachet-brains-anthropic installed')
  when('rhachet upgrade --brains anthropic')
    then('exits with status 0')
      sothat('user knows upgrade succeeded')
    then('rhachet-brains-anthropic is upgraded to latest')
      sothat('user gets newest brain features')
    then('stdout confirms brain was upgraded')
      sothat('user sees what changed')

---

# usecase.3 = upgrade all brains via wildcard

given('repo with multiple rhachet-brains-* packages installed')
  when('rhachet upgrade --brains *')
    then('exits with status 0')
    then('all rhachet-brains-* packages are upgraded')
      sothat('user can upgrade all brains with one command')

---

# usecase.4 = upgrade brains + roles together

given('repo with both rhachet-roles-* and rhachet-brains-* packages installed')
  when('rhachet upgrade --brains * --roles *')
    then('exits with status 0')
    then('all rhachet-brains-* packages are upgraded')
    then('all rhachet-roles-* packages are upgraded')
      sothat('user can upgrade both suppliers in one command')

---

# usecase.5 = default behavior upgrades all suppliers

given('repo with rhachet, rhachet-roles-*, and rhachet-brains-* packages installed')
  when('rhachet upgrade (no flags)')
    then('exits with status 0')
    then('rhachet is upgraded')
    then('all rhachet-roles-* packages are upgraded')
    then('all rhachet-brains-* packages are upgraded')
      sothat('default behavior upgrades all, same as current roles-only default extended to brains')

---

# usecase.6 = file:. dependency handle

given('inside a rhachet-brains-* repo with file:. self-reference')
  when('rhachet upgrade --brains *')
    then('package with file:. version is skipped')
      sothat('local development is not disrupted')
    then('stdout indicates package was skipped')
      sothat('user understands why package was not upgraded')

---

# usecase.7 = error on absent brain package

given('repo without any rhachet-brains-* packages installed')
  when('rhachet upgrade --brains anthropic')
    then('exits with non-zero status')
    then('stderr contains error about package not installed')
      sothat('user knows they need to install the package first')

---

# usecase.8 = brains-only upgrade

given('repo with both rhachet-roles-* and rhachet-brains-* packages installed')
  when('rhachet upgrade --brains *')
    then('rhachet-brains-* packages are upgraded')
    then('rhachet-roles-* packages are NOT upgraded')
      sothat('user can upgrade brains independently of roles')

---

# usecase.9 = roles-only upgrade (regression check)

given('repo with both rhachet-roles-* and rhachet-brains-* packages installed')
  when('rhachet upgrade --roles *')
    then('rhachet-roles-* packages are upgraded')
    then('rhachet-brains-* packages are NOT upgraded')
      sothat('current roles-only behavior is preserved')

---

# usecase.10 = output summary includes brains

given('repo with rhachet-brains-anthropic installed')
  when('rhachet upgrade --brains anthropic')
    then('stdout contains brain upgrade summary')
      sothat('user sees confirmation of what was upgraded')
    then('summary mentions brain package name')
      sothat('user knows exactly which brains were upgraded')
