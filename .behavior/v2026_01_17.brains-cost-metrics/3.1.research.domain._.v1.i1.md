# research: extant domain for brain cost metrics

this document enumerates the extant domain objects relevant to the brain cost metrics feature.

---

## extant domain objects

### entities

entities are objects with unique identity tracked over time.

#### BrainAtom

```ts
interface BrainAtom {
  repo: string;   // e.g., "anthropic"
  slug: string;   // e.g., "claude/opus"
  description: string;
  ask: <TOutput>(
    input: {
      plugs?: BrainAtomPlugs;
      role: { briefs?: Artifact<typeof GitFile>[] };
      prompt: string;
      schema: { output: z.Schema<TOutput> };
    },
    context?: Empty,
  ) => Promise<TOutput>;
}
```

> [1] "entities are objects defined by their unique identities rather than by their attributes" — [enterprisecraftsmanship](https://enterprisecraftsmanship.com/posts/entity-vs-value-object-the-ultimate-list-of-differences/)

the `BrainAtom` is an entity because:
- it has identity (`repo` + `slug` as unique key)
- its state (the base model) can change over time (e.g., model updates, price changes)
- it represents a distinct llm inference endpoint

**current return type**: `Promise<TOutput>` — returns output directly without metrics.

#### BrainRepl

```ts
interface BrainRepl {
  repo: string;
  slug: string;
  description: string;
  ask: <TOutput>(
    input: {
      plugs?: BrainReplPlugs;
      role: { briefs?: Artifact<typeof GitFile>[] };
      prompt: string;
      schema: { output: z.Schema<TOutput> };
    },
    context?: Empty,
  ) => Promise<TOutput>;
  act: <TOutput>(
    input: {
      plugs?: BrainReplPlugs;
      role: { briefs?: Artifact<typeof GitFile>[] };
      prompt: string;
      schema: { output: z.Schema<TOutput> };
    },
    context?: Empty,
  ) => Promise<TOutput>;
}
```

same rationale as BrainAtom — identity via `repo` + `slug`.

**current return type**: `Promise<TOutput>` — returns output directly without metrics.

---

### literals (value objects)

no extant literals are directly relevant to cost metrics.

adjacent types that exist in the broader ecosystem:
- `z.Schema<TOutput>` — zod schema for structured output validation
- `Artifact<typeof GitFile>` — file artifact for briefs

---

### events

no extant events are relevant to this feature.

---

## extant operations

### BrainAtom.ask

single-turn inference. plugin handles role.briefs appropriately.

| operation | current return | notes |
|-----------|----------------|-------|
| `atom.ask()` | `Promise<TOutput>` | no metrics, no cost data |

### BrainRepl.ask

readonly analysis operation (research, queries, code review) with read-only access.

| operation | current return | notes |
|-----------|----------------|-------|
| `repl.ask()` | `Promise<TOutput>` | no metrics, no cost data |

### BrainRepl.act

read+write action operation with full agentic capabilities.

| operation | current return | notes |
|-----------|----------------|-------|
| `repl.act()` | `Promise<TOutput>` | no metrics, no cost data |

---

## extant relationships

```
BrainAtom
  └── unique: [repo, slug]

BrainRepl
  └── unique: [repo, slug]
```

no composition relationships exist yet between brains and usage/cost profiles.

---

## gap analysis

the extant domain lacks:

1. **static profile** — no way to query a brain's cost rates or capabilities
2. **invocation metrics** — `.ask()` and `.act()` return `TOutput` without usage data
3. **cost calculation** — no mechanism to convert token counts into cash costs

the wish requires:
- extend `BrainAtom` and `BrainRepl` to expose their static profiles
- modify return type of `.ask()` and `.act()` to include metrics alongside output
- add operations to lookup profiles and calculate costs

---

## citations

1. enterprisecraftsmanship — entity identity definition

---

## sources

- [entity vs value object](https://enterprisecraftsmanship.com/posts/entity-vs-value-object-the-ultimate-list-of-differences/)
