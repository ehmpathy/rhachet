# execution: npx rhachet upgrade

## phase 1: foundation

### 1.1 create ContextCli domain object
- [ ] create `src/domain.objects/ContextCli.ts`
- [ ] export from `src/domain.objects/index.ts`

### 1.2 create UpgradeExecutionError
- [ ] create `src/domain.operations/upgrade/UpgradeExecutionError.ts`

## phase 2: domain operations

### 2.1 create discoverLinkedRoles
- [ ] create `src/domain.operations/upgrade/discoverLinkedRoles.ts`
- [ ] create `src/domain.operations/upgrade/discoverLinkedRoles.test.ts`

### 2.2 create resolveRolesToPackages
- [ ] create `src/domain.operations/upgrade/resolveRolesToPackages.ts`
- [ ] create `src/domain.operations/upgrade/resolveRolesToPackages.test.ts`

### 2.3 create execNpmInstall
- [ ] create `src/domain.operations/upgrade/execNpmInstall.ts`
- [ ] create `src/domain.operations/upgrade/execNpmInstall.integration.test.ts`

### 2.4 update initRolesFromPackages to use ContextCli
- [ ] modify `src/domain.operations/init/initRolesFromPackages.ts`
- [ ] update all call sites

### 2.5 create execUpgrade orchestration
- [ ] create `src/domain.operations/upgrade/execUpgrade.ts`
- [ ] create `src/domain.operations/upgrade/execUpgrade.test.ts`

## phase 3: CLI contract

### 3.1 create invokeUpgrade
- [ ] create `src/contract/cli/invokeUpgrade.ts`

### 3.2 create invokeUpdate (discoverability)
- [ ] create `src/contract/cli/invokeUpdate.ts`

### 3.3 register commands in invoke.ts
- [ ] modify `src/contract/cli/invoke.ts`

## phase 4: acceptance tests

### 4.1 create upgrade acceptance tests
- [ ] create `accept.blackbox/cli/upgrade.acceptance.test.ts`

### 4.2 verify full blackbox criteria
- [ ] all usecases pass

## phase 5: cleanup

### 5.1 export new modules
- [ ] export from `src/domain.operations/upgrade/index.ts`
