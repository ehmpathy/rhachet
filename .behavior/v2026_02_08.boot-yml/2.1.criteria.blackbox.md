# criteria.blackbox: boot.yml for role context curation

## usecase.1 = no boot.yml (backwards compatible)

```
given('a role with no boot.yml')
  when('the role is booted')
    then('all briefs are said with full content')
      sothat('current behavior is preserved')
    then('all skills are said with full content')
      sothat('current behavior is preserved')
```

---

## usecase.2 = simple mode: say all (explicit)

```
given('a role with boot.yml in simple mode')
  given('briefs: {} with no say key')
    when('the role is booted')
      then('all briefs are said with full content')
        sothat('absent say key means say all')

  given('skills: {} with no say key')
    when('the role is booted')
      then('all skills are said with full content')
        sothat('absent say key means say all')

  given('briefs key is absent entirely')
    when('the role is booted')
      then('all briefs are said with full content')
        sothat('absent resource key means say all for that resource')
```

---

## usecase.3 = simple mode: say list curates

```
given('a role with boot.yml in simple mode')
  given('briefs.say contains glob patterns')
    when('the role is booted')
      then('briefs that match the globs are said with full content')
      then('briefs that do not match the globs are ref with path only')
        sothat('say list flips default from say-all to ref-all-except-matched')

  given('briefs.say is an empty array []')
    when('the role is booted')
      then('all briefs are ref with path only')
      then('no briefs are said')
        sothat('empty say list means say none')

  given('briefs.say has globs but skills key is absent')
    when('the role is booted')
      then('matched briefs are said, unmatched are ref')
      then('all skills are said with full content')
        sothat('each resource type is independent')
```

---

## usecase.4 = subject mode: boot all subjects

```
given('a role with boot.yml in subject mode')
  given('always section and multiple subject sections')
    when('the role is booted without --usecase flag')
      then('always.briefs.say briefs are said first')
      then('always.briefs.ref briefs are ref first')
      then('always.skills.say skills are said first')
      then('each subject section briefs/skills are included')
      then('briefs not in any glob appear in also section as refs')
        sothat('all subjects are booted with always first and also last')
```

---

## usecase.5 = subject mode: boot specific subjects

```
given('a role with boot.yml in subject mode')
  given('always section and subject.test and subject.terms sections')
    when('the role is booted with --usecase test')
      then('always briefs/skills are included')
      then('subject.test briefs/skills are included')
      then('subject.terms briefs/skills are NOT included')
      then('also section is NOT included')
        sothat('only selected subjects are booted')

    when('the role is booted with --usecase test,terms')
      then('always briefs/skills are included')
      then('subject.test briefs/skills are included')
      then('subject.terms briefs/skills are included')
      then('also section is NOT included')
        sothat('multiple subjects can be selected')
```

---

## usecase.6 = subject mode: overlap dedupe

```
given('a role with boot.yml in subject mode')
  given('same brief glob appears in subject.test.briefs.say and subject.terms.briefs.say')
    when('the role is booted with --usecase test,terms')
      then('first occurrence (subject.test) says the brief with full content')
      then('second occurrence (subject.terms) shows "(as mentioned earlier in subject.test)" with path only')
        sothat('duplication is prevented while discoverability is preserved')

  given('same brief glob appears in always.briefs.say and subject.test.briefs.say')
    when('the role is booted with --usecase test')
      then('always says the brief with full content')
      then('subject.test shows "(as mentioned earlier in always)" with path only')
        sothat('always wins over subject')
```

---

## usecase.7 = mode detection and fail fast

```
given('a boot.yml with mixed mode patterns')
  given('top-level briefs: AND always: keys both present')
    when('the role is booted')
      then('boot fails fast with error "mixed mode not allowed"')
        sothat('ambiguous config is rejected immediately')

  given('top-level skills: AND subject.test: keys both present')
    when('the role is booted')
      then('boot fails fast with error "mixed mode not allowed"')
        sothat('ambiguous config is rejected immediately')
```

---

## usecase.8 = edge cases

```
given('a role with boot.yml in simple mode')
  when('the role is booted with --usecase flag')
    then('boot fails fast with error "usecase requires subject mode"')
      sothat('usecase flag is only valid in subject mode')

given('a role with boot.yml in subject mode')
  when('the role is booted with --usecase unknownsubject')
    then('boot fails fast with error "subject not found: unknownsubject"')
      sothat('typos and invalid subjects are caught early')

given('a role with boot.yml in subject mode')
  given('always section is absent')
    when('the role is booted')
      then('no briefs/skills are always included')
      then('only subject-specific briefs/skills are included')
        sothat('always section is optional')

given('a role with boot.yml in subject mode')
  given('a brief matches always.briefs.ref AND subject.test.briefs.say')
    when('the role is booted with --usecase test')
      then('the brief is said (say wins over ref)')
        sothat('say is stronger than ref when both match')
```

---

## usecase.9 = output structure

```
given('a role with boot.yml in simple mode')
  when('the role is booted')
    then('said briefs appear as <brief path="...">content</brief>')
    then('ref briefs appear as <ref path="..."/>')
    then('said skills appear as <skill path="...">content</skill>')
    then('ref skills appear as <ref path="..."/>')

given('a role with boot.yml in subject mode')
  when('the role is booted with all subjects')
    then('always section content appears first')
    then('subject sections content appears next in declaration order')
    then('also section appears last wrapped in <also>...</also>')
      sothat('output is structured and predictable')
```
