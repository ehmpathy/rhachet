# domain terms: final choice (v1.i4)

formalizes the brain terminology choices for brain-continue

---

## tldr

| container   | unit         | step          |
| ----------- | ------------ | ------------- |
| BrainSeries | BrainEpisode | BrainExchange |

---

## 1. brain terms (Brain*)

### chosen terms

| term            | what                                    | scope                | owner                 |
| --------------- | --------------------------------------- | -------------------- | --------------------- |
| `BrainSeries`   | chain of episodes bridged by compaction | 1..N context windows | BrainRepl only        |
| `BrainEpisode`  | one context window of exchanges         | one context window   | BrainAtom + BrainRepl |
| `BrainExchange` | one request-response pair               | one api call         | BrainAtom + BrainRepl |

### rationale

| decision                           | rationale                                                                                                                                 |
| ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| `BrainSeries` for BrainRepl        | chain of episodes; compaction bridges episodes into continuous series; tv metaphor (series > episode > scene)                             |
| `BrainEpisode` over `BrainSession` | precision over industry alignment; "episode" implies bounded continuity; compaction = new episode with recap; rich tv/healthcare metaphor |
| `BrainExchange` over `BrainTurn`   | explicit bidirectional semantics; "turn" implies one direction; "exchange" captures full round-trip                                       |
| `Brain*` prefix                    | explicit supplier ownership; no ambiguity with navigator concepts                                                                         |

### hierarchy

```
BrainSeries (BrainRepl only)
└── BrainEpisode[] (1..N per series)
    └── BrainExchange[] (1..N per episode)
```

### brain type support

| term            | BrainAtom | BrainRepl |
| --------------- | --------- | --------- |
| `BrainSeries`   | ✗         | ✓         |
| `BrainEpisode`  | ✓         | ✓         |
| `BrainExchange` | ✓         | ✓         |

---

## 2. continuation semantics

### BrainAtom continuation

```ts
// start new episode
const { episode, output } = await atom.ask({ say: '...' });

// continue episode (add exchanges)
const { episode, output } = await atom.ask({ on: { episode }, say: '...' });
```

BrainAtom is stateless — no series awareness. the caller manages episode chains manually.

### BrainRepl continuation

```ts
// start new series (and first episode)
const { series, episode, output } = await repl.ask({ say: '...' });

// continue series (resume repl)
const { series, episode, output } = await repl.ask({ on: { series }, say: '...' });

// continue specific episode (add exchanges)
const { series, episode, output } = await repl.ask({ on: { episode }, say: '...' });
```

BrainRepl supports `PickOne<{ episode, series }>`:

| continuation      | what it does                                     | when to use                          |
| ----------------- | ------------------------------------------------ | ------------------------------------ |
| `on: { series }`  | resume series at current episode (or start next) | linear continuation of repl session  |
| `on: { episode }` | add exchanges to that specific episode           | branch or resume from a prior state  |

### compaction boundary

when context window fills, BrainRepl compacts:

```
Series A
├── Episode 0: exchanges 0-50 → context full → compact
└── Episode 1: recap + exchanges 51-100 → ...
```

- `in: { series: A }` → continues Episode 1 (or starts Episode 2 if full)
- `in: { episode: Episode1 }` → continues Episode 1 specifically
- `in: { episode: Episode0 }` → error (cannot add to compacted episode)

---

## 3. usage examples

### BrainAtom

```ts
// episode continuation only
const { episode, output } = await atom.ask({ say: 'what is a cat?' });
await atom.ask({ on: { episode }, say: 'what is a dog?' });
```

### BrainRepl

```ts
// series continuation (typical)
const { series, output } = await repl.ask({ say: 'review this code' });
await repl.ask({ on: { series }, say: 'now fix the issues' });

// episode continuation (within series)
const { episode, output } = await repl.ask({ say: 'explain this function' });
await repl.ask({ on: { episode }, say: 'what about edge cases?' });
```

---

## 4. summary

| concept            | term            | owner                 |
| ------------------ | --------------- | --------------------- |
| episode chain      | `BrainSeries`   | BrainRepl only        |
| one context window | `BrainEpisode`  | BrainAtom + BrainRepl |
| one round-trip     | `BrainExchange` | BrainAtom + BrainRepl |
