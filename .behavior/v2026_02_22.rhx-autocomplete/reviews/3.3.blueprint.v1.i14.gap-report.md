# gap report: blueprint v1 junior review (iteration 14)

## summary

| category | count | status |
|----------|-------|--------|
| criteria gaps | 0 | none found |
| vision gaps | 0 | none found |
| contract gaps | 0 | none found |
| error case gaps | 0 | none found |

**blockers found**: 0
**nitpicks found**: 0
**all criteria covered**: yes

---

## methodology

1. read criteria document line by line
2. for each criteria statement, locate blueprint mechanism
3. verify mechanism is complete and correct
4. document any gaps found

---

## usecase.1 = tab completion

### episode: complete partial skill name (criteria lines 7-26)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 11-12 | `rhx git.<tab>` shows skills that start with "git." | `_rhx()` calls `rhachet completion --list`, zsh `_describe` handles prefix filter | genZshCompletionCode lines 500-510 | no |
| 15-16 | `rhx git.commit.<tab>` completes to longest common prefix | zsh native `_describe` behavior | zsh handles this | no |
| 19-20 | `rhx git.commit.s<tab>` shows options | zsh native `_describe` filters by prefix | zsh handles this | no |
| 23-24 | `rhx nonexistent<tab>` shows no completions | zsh `_describe` returns empty when no match | zsh handles this | no |

### episode: cwd-aware completions (criteria lines 28-42)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 35-36 | in repoA, shows "deploy.prod" only | dynamic completion via `rhachet completion --list` runs in cwd | invokeCompletions lines 291-299 | no |
| 39-40 | cd to repoB, shows "deploy.dev" only | dynamic runs fresh on each tab press | genZshCompletionCode line 506 | no |

**acceptance test coverage**: completions.acceptance.test.ts lines 963-994 test cwd-aware behavior with `with-skill-a` and `with-skill-b` fixtures.

---

## usecase.2 = rhx list

### episode: list all skills (criteria lines 48-69)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 53-54 | tree of skills grouped by repo/role | `formatAsTree` with `getGroupKey: repo=${slugRepo}/role=${slugRole}` | formatSkillList lines 803-809 | no |
| 55 | each skill shows name and .what | `getAllSkillsWithEntries` calls `getSkillWhatLine` | getAllSkillsWithEntries lines 478-484 | no |
| 58-59 | `--repo .this` filters to repo | `discoverSkillExecutables({ slugRepo: opts.repo })` | invokeSkillsSubcommand lines 337-340 | no |
| 62-63 | `--role mechanic` filters to role | `discoverSkillExecutables({ slugRole: opts.role })` | invokeSkillsSubcommand lines 337-340 | no |
| 66-67 | `--output json` produces valid JSON | `formatAsJson` | formatSkillList lines 789-798 | no |

### episode: no skills found (criteria lines 71-80)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 76-77 | shows "no skills found in .agent/" | `if (skillsFound.length === 0) console.log(...)` | invokeSkillsSubcommand lines 342-345 | no |
| 78 | exit code is 0 | no throw, returns normally | invokeSkillsSubcommand line 344 | no |

---

## usecase.3 = rhx search

### episode: search by keyword (criteria lines 84-105)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 92-93 | shows skills with "commit" in name or description | `getSkillsMatchedByQuery` checks slug and description | getSkillsMatchedByQuery lines 544-547 | no |
| 94 | shows context snippets | `getBriefsMatchedByQuery` calls `getSnippetFromContent` | getBriefsMatchedByQuery lines 683-685 | no |
| 97-98 | `--scope skills` shows only skills | conditional in action | invokeSkillsSubcommand lines 368-373 | no |
| 101-102 | no matches shows message | `console.log('no matches for ...')` | invokeSkillsSubcommand lines 385-387 | no |
| 103 | exit code is 0 | no throw, returns normally | invokeSkillsSubcommand line 387 | no |

---

## usecase.4 = rhachet completion

### episode: generate completion code (criteria lines 109-120)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 116-117 | outputs valid zsh completion code | `genZshCompletionCode()` | genZshCompletionCode lines 497-521 | no |
| 118 | code can be eval'd in zsh | valid zsh syntax with `#compdef`, `_describe` | genZshCompletionCode output | no |

### episode: cache refresh (criteria lines 122-136)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 128-129 | `npx rhachet init` refreshes cache | N/A - dynamic completion has no cache | overview line 7 | no |
| 132-134 | `source ~/.zshrc` re-evals fresh completions | dynamic completion via `--list` on each tab | genZshCompletionCode lines 498-499 | no |

---

## usecase.5 = first-time setup

### episode: install completions (criteria lines 140-152)

| criteria line | statement | blueprint mechanism | blueprint location | gap? |
|---------------|-----------|--------------------|--------------------|------|
| 148-150 | `rhachet completion --setup` enables completion | `genZshCompletionCode` outputs completion code | genZshCompletionCode lines 500-520 | no |
| 151 | setup is one-liner | single `rhachet completion --setup` command | vision line 189 | no |

---

## exchange contracts (criteria lines 156-193)

### rhx list (criteria lines 158-167)

| input | expected | mechanism | gap? |
|-------|----------|-----------|------|
| (no args) | tree of all skills | `formatAsTree` default | no |
| `--repo <slug>` | filtered to repo | `discoverSkillExecutables` | no |
| `--role <slug>` | filtered to role | `discoverSkillExecutables` | no |
| `--output tree` | tree format | `formatAsTree` | no |
| `--output flat` | flat list | `formatAsFlat` | no |
| `--output json` | JSON array | `formatAsJson` | no |

### rhx search (criteria lines 169-178)

| input | expected | mechanism | gap? |
|-------|----------|-----------|------|
| `<query>` | matched skills and briefs | query functions | no |
| `--scope skills` | skills only | conditional | no |
| `--scope briefs` | briefs only | conditional | no |
| `--scope all` | both | default | no |
| `--output tree` | grouped output | `formatSearchResults` | no |
| `--output json` | JSON array | `formatSearchResults` | no |

### rhachet completion (criteria lines 180-184)

| input | expected | mechanism | gap? |
|-------|----------|-----------|------|
| `zsh` | zsh completion code | `genZshCompletionCode` | no |

### tab completion zsh (criteria lines 186-192)

| input | expected | mechanism | gap? |
|-------|----------|-----------|------|
| `rhx <partial><tab>` | matched skills | `_rhx` via `_describe` | no |
| `rhx <partial><tab><tab>` | list all | zsh native | no |
| `rhachet run --skill <partial><tab>` | matched skills | `_rhachet_run_skill` | no |

---

## error cases (criteria lines 196-203)

| scenario | expected | mechanism | gap? |
|----------|----------|-----------|------|
| no .agent/ | "no skills found" | console.log | no |
| invalid --output | error with options | `assertValidOption` | no |
| invalid --scope | error with options | `assertValidOption` | no |
| empty query | show all | return all items | no |

---

## vision coverage

| vision item | criteria reference | blueprint | gap? |
|-------------|-------------------|-----------|------|
| `rhx list` tree output | usecase 2 lines 53-55 | formatAsTree | no |
| `rhx search` with snippets | usecase 3 lines 92-94 | getBriefsMatchedByQuery | no |
| tab completion | usecase 1 lines 11-24 | genZshCompletionCode | no |
| interactive fuzzy (stretch) | vision lines 118-131 | not included | no (stretch) |
| cwd-aware | usecase 1 lines 35-41 | dynamic completion | no |
| `rhachet completion --setup` | vision line 172 | bin/rhx completion case | no |
| fast completions | vision line 284 | rhachet-roles.bc route | no |

---

## code quality checks

| check | status |
|-------|--------|
| get verb for operations | yes: getAllSkillsWithEntries, getSkillsMatchedByQuery, getBriefsMatchedByQuery |
| queryLowercased name | yes: line 542, 663 |
| pathMatched/contentMatched names | yes: lines 677-678 |
| .why on types | yes: types.ts lines 227-269 |
| flatMap for composition | yes: getAllMdFilesRecursive, getAllBriefFiles, formatAsTree |
| try/catch for file reads | yes: getSkillWhatLine, getBriefsMatchedByQuery |
| combined types (SkillWithEntry) | yes: no parallel arrays |

---

## acceptance tests

| test | coverage | status |
|------|----------|--------|
| zsh interface contract | #compdef, _rhx(), _describe, --list call | specified |
| cwd-aware behavior | repoA vs repoB fixtures | specified |

---

## conclusion

**no gaps detected.**

the blueprint covers:
- all 5 usecases with all criteria statements
- all 4 exchange contract tables
- all 4 error cases
- all vision items (except stretch goal)
- code follows practices: get verb, flatMap, try/catch, combined types

the blueprint is ready for implementation.
