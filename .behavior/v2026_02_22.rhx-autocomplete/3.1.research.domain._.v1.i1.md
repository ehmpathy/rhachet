# research: domain

## domain objects

### entities

| entity | identity | description |
|--------|----------|-------------|
| `Skill` | path | executable capability in `.agent/repo=*/role=*/skills/` |
| `Role` | slug | bundle of skills and briefs |
| `RoleRepo` | slug | namespace of roles (e.g., `.this`, `ehmpathy`) |

### literals

| literal | description |
|---------|-------------|
| `SkillName` | name of skill (e.g., `git.commit.set`) |
| `SkillDescription` | `.what` header content from skill file |
| `CompletionEntry` | `name:description` pair for zsh _describe |
| `RepoRootPath` | absolute path to repo root |

### events

| event | trigger |
|-------|---------|
| `SkillDiscovered` | skill file found in `.agent/` scan |
| `CompletionGenerated` | completion code output to stdout |
| `CacheRefreshed` | completion cache updated for repo |

---

## domain operations

### getOne

| operation | input | output |
|-----------|-------|--------|
| `getOneSkillByName` | `{ name: SkillName }` | `Skill \| null` |
| `getOneRepoRoot` | `{ cwd: string }` | `RepoRootPath \| null` |

### getAll

| operation | input | output |
|-----------|-------|--------|
| `getAllSkills` | `{ repoRoot: RepoRootPath }` | `Skill[]` |
| `getAllSkillsByRepo` | `{ repo: string }` | `Skill[]` |
| `getAllSkillsByRole` | `{ role: string }` | `Skill[]` |
| `getAllCompletionEntries` | `{ skills: Skill[] }` | `CompletionEntry[]` |

### set (mutations)

| operation | input | output |
|-----------|-------|--------|
| `setCompletionCache` | `{ repoRoot, entries }` | `void` |

---

## relationships

```
RoleRepo (1) ──contains──> (N) Role
Role (1) ──contains──> (N) Skill
Skill (1) ──produces──> (1) CompletionEntry
RepoRootPath (1) ──scopes──> (N) Skill
```

### treestruct

```
.agent/
  repo={slug}/           # RoleRepo
    role={slug}/         # Role
      skills/
        {name}.sh        # Skill
```

### dependencies

```
CompletionEntry ← depends on ← Skill
Skill ← scoped by ← RepoRootPath (cwd-aware)
getAllSkills ← requires ← getOneRepoRoot
```

---

## composition for wish

### flow: tab completion

```
1. user types `rhx <partial><tab>`
2. zsh calls completion function
3. completion function calls `rhachet completion`
4. rhachet:
   a. getOneRepoRoot({ cwd })
   b. getAllSkills({ repoRoot })
   c. getAllCompletionEntries({ skills })
   d. emit zsh code with entries
5. zsh displays matches
```

### flow: rhx list

```
1. user runs `rhx list`
2. rhachet:
   a. getOneRepoRoot({ cwd })
   b. getAllSkills({ repoRoot })
   c. filter by --repo, --role if provided
   d. format output (tree, flat, json)
```

### flow: rhx search

```
1. user runs `rhx search <query>`
2. rhachet:
   a. getOneRepoRoot({ cwd })
   b. getAllSkills({ repoRoot })
   c. filter skills by query match (name, description)
   d. format output
```

---

## no new terms coined

all terms above are extant in rhachet domain:
- `Skill`, `Role`, `RoleRepo` — from `.agent/` structure
- `RepoRootPath` — standard fs concept
- `CompletionEntry` — zsh standard (name:description pair)
