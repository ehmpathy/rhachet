# execution: phase0 to phaseN

progress tracker for roadmap at `.behavior/v2026_01_09.init-roles-many/4.1.roadmap.v1.i1.md`

---

## milestone.0 = domain objects

### step.0.1 = RoleSpecifier type alias

- [x] create `src/domain.objects/RoleSpecifier.ts`
- [x] export type alias with format documentation

**status**: done

---

### step.0.2 = RoleRegistryManifest domain object

- [x] create `src/domain.objects/RoleRegistryManifest.ts`
- [x] define interface with slug, readme, roles[]
- [x] add zod schema for validation
- [x] create unit tests (15 tests pass)

**status**: done

---

## milestone.1 = manifest operations

### step.1.1 = getRoleRegistryManifest

- [x] create `src/domain.operations/manifest/getRoleRegistryManifest.ts`
- [x] read and parse yaml from packageRoot
- [x] validate against schema
- [x] create unit tests (13 tests pass)
- [ ] create integration tests

**status**: done (integration tests deferred)

---

### step.1.2 = castManifestToRegistry

- [x] create `src/domain.operations/manifest/castManifestToRegistry.ts`
- [x] transform manifest roles to Role[]
- [x] resolve paths relative to packageRoot
- [x] add limitation comments (static refs only, no runtime logic)
- [x] create unit tests (15 tests pass)

**status**: done

---

### step.1.3 = discoverRegistriesFromPackages

- [x] create `src/domain.operations/manifest/discoverRegistriesFromPackages.ts`
- [x] scan package.json for rhachet-roles-* packages
- [x] resolve each package path in node_modules
- [x] load manifest via getRoleRegistryManifest
- [x] cast to registry via castManifestToRegistry
- [x] collect errors for packages that lack manifest
- [x] create integration tests (4 tests pass)

**status**: done

---

## milestone.2 = role resolution

### step.2.1 = parseRoleSpecifier

- [x] create `src/domain.operations/invoke/parseRoleSpecifier.ts`
- [x] parse "mechanic" => { repo: null, role: "mechanic" }
- [x] parse "ehmpathy/mechanic" => { repo: "ehmpathy", role: "mechanic" }
- [x] create unit tests (11 tests pass)

**status**: done

---

### step.2.2 = resolveRoleSpecifiers

- [x] create `src/domain.operations/invoke/resolveRoleSpecifiers.ts`
- [x] parse each specifier via parseRoleSpecifier
- [x] find role in registries (exact match if repo specified)
- [x] use inferRepoByRole for unqualified specifiers
- [x] collect all errors before fail
- [x] create unit tests (14 tests pass)

**status**: done

---

## milestone.3 = init --roles command

### step.3.1 = showInitUsageInstructions

- [x] create `src/domain.operations/init/showInitUsageInstructions.ts`
- [x] discover registries from packages
- [x] enumerate available roles with source package
- [x] output usage format per blueprint
- [x] create integration tests (4 tests pass)

**status**: done

---

### step.3.2 = initRolesFromPackages

- [x] create `src/domain.operations/init/initRolesFromPackages.ts`
- [x] discover registries from packages
- [x] validate all packages have rhachet.repo.yml
- [x] resolve all role specifiers (fail fast if any absent/ambiguous)
- [x] for each resolved role: link + init
- [x] report success with summary
- [ ] create integration tests (deferred - requires rhachet.repo.yml in packages)

**status**: done (integration tests deferred)

---

### step.3.3 = extend invokeInit with --roles and --config

- [x] modify `src/contract/cli/invokeInit.ts`
- [x] add --roles option
- [x] add --config option (undocumented)
- [x] route to initRolesFromPackages when --roles provided
- [x] route to generateRhachetUseTs when --config provided
- [x] route to showInitUsageInstructions when no flags
- [x] migrate prior integration tests to --config path (11 tests pass)
- [ ] create new integration tests for --roles path (deferred - requires rhachet.repo.yml in packages)

**status**: done (--roles integration tests deferred)

---

## milestone.4 = repo introspect command

### step.4.1 = generateRoleRegistryManifest

- [x] create `src/domain.operations/manifest/generateRoleRegistryManifest.ts`
- [x] transform RoleRegistry to manifest structure
- [x] resolve paths relative to package root
- [x] serialize to yaml string
- [x] create unit tests (16 tests pass)

**status**: done

---

### step.4.2 = invokeRepoIntrospect

- [x] create `src/contract/cli/invokeRepoIntrospect.ts`
- [x] register `repo introspect` command
- [x] add --output option (default: rhachet.repo.yml, or stdout)
- [x] dynamically import registry from package
- [x] generate manifest via generateRoleRegistryManifest
- [x] write to output destination
- [x] register command in invoke.ts
- [x] create integration tests (9 tests pass)

**status**: done

---

## milestone.5 = extend roles link/init without rhachet.use.ts

### step.5.1 = hasConfigExplicit utility

- [x] create utility to check for rhachet.use.ts existence
- [x] return boolean
- [x] create unit tests (2 tests pass)

**status**: done

---

### step.5.2 = extend invokeRolesLink

- [x] modify `src/contract/cli/invokeRolesLink.ts`
- [x] check hasConfigExplicit first (explicit path)
- [x] fallback to discoverRegistriesFromPackages
- [x] fail fast with BadRequestError if no registries
- [x] update integration tests (7 tests pass)

**status**: done

---

### step.5.3 = extend invokeRolesInit

- [x] modify `src/contract/cli/invokeRolesInit.ts`
- [x] same fallback pattern as invokeRolesLink
- [x] update integration tests (6 tests pass)

**status**: done

---

## milestone.6 = acceptance tests

### step.6.1 = blackbox acceptance tests

- [ ] create acceptance test for usecase.1 (init multiple roles)
- [ ] create acceptance test for usecase.2 (disambiguation)
- [ ] create acceptance test for usecase.3 (repo introspect)
- [ ] create acceptance test for usecase.4 (roles link without rhachet.use.ts)
- [ ] create acceptance test for usecase.5 (roles init without rhachet.use.ts)
- [ ] create acceptance test for usecase.6 (rhachet.repo.yml discovery)
- [ ] create acceptance test for edge.1 (role not found)
- [ ] create acceptance test for edge.2 (partial success on init failure)
- [ ] create acceptance test for edge.3 (no packages error)
- [ ] create acceptance test for edge.4 (mixed disambiguation)
- [ ] create acceptance test for boundary.3 (backward compatibility)

**status**: queued

---

## milestone.7 = documentation

### step.7.1 = README updates

- [ ] document `npx rhachet init --roles` command
- [ ] document `repo/role` disambiguation pattern
- [ ] document `npx rhachet repo introspect` command
- [ ] document `rhachet.repo.yml` schema
- [ ] add example invocations

**status**: queued
