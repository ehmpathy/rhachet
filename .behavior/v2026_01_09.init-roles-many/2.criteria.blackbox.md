# blackbox criteria: init-roles-many

experience bounds required to fulfill the wish.

---

## usecase.1 = init multiple roles with one command

```
given('a repo with rhachet-roles packages installed via npm')
  when('user runs `npx rhachet init --roles mechanic behaver reviewer`')
    then('all three roles are linked into .agent/ directories')
    then('all three roles have their init scripts executed')
    then('success message shows which roles were initialized')
      sothat('users can setup multiple roles in one command')

  when('user runs `npx rhachet init --roles mechanic`')
    then('only the mechanic role is linked and initialized')
      sothat('single role initialization still works')

  when('consumer runs `npx rhachet init` with no --roles flag')
    then('command outputs usage instructions')
    then('instructions explain --roles flag syntax')
    then('instructions list roles that exist in installed packages')
      sothat('consumers know how to use the command and what roles are available')
```

---

## usecase.2 = disambiguation via repo/role pattern

```
given('multiple rhachet-roles packages with same role name')
  when('user runs `npx rhachet init --roles mechanic`')
    then('error lists all packages that contain a role named "mechanic"')
    then('error suggests use of repo/role pattern to disambiguate')
      sothat('users know how to resolve ambiguity')

  when('user runs `npx rhachet init --roles ehmpathy/mechanic bhuild/behaver`')
    then('mechanic role is initialized from rhachet-roles-ehmpathy package')
    then('behaver role is initialized from rhachet-roles-bhuild package')
      sothat('users can explicitly specify which repo provides each role')
```

---

## usecase.3 = repo introspect command for publishers

```
given('a rhachet-roles publisher package')
  when('author runs `npx rhachet repo introspect`')
    then('rhachet.repo.yml is generated at package root')
    then('yml contains role directories for each role in the registry')
    then('yml contains init scripts for each role')
      sothat('publishers can generate manifest for consumers')

  when('author runs `npx rhachet repo introspect --dry-run`')
    then('yml content is output to stdout without file write')
      sothat('authors can preview before commit')
```

---

## usecase.4 = roles link without rhachet.use.ts

```
given('a repo without rhachet.use.ts')
  when('user runs `npx rhachet roles link --role mechanic`')
    then('role is discovered from installed rhachet-roles packages')
    then('role is linked into .agent/ directory')
    then('no error about absent rhachet.use.ts')
      sothat('rhachet.use.ts is no longer required for link')

  when('user runs `npx rhachet roles link --role ehmpathy/mechanic`')
    then('role is linked from the specified repo')
      sothat('disambiguation works without rhachet.use.ts')
```

---

## usecase.5 = roles init without rhachet.use.ts

```
given('a repo without rhachet.use.ts but with linked roles')
  when('user runs `npx rhachet roles init --role mechanic`')
    then('init scripts for mechanic role are executed')
    then('no error about absent rhachet.use.ts')
      sothat('rhachet.use.ts is no longer required for init')

  when('user runs `npx rhachet roles init --role mechanic --command setup`')
    then('only the "setup" init script is executed')
      sothat('specific init commands still work')
```

---

## usecase.6 = rhachet.repo.yml discovery

```
given('a rhachet-roles package with rhachet.repo.yml')
  when('user runs `npx rhachet init --roles mechanic`')
    then('rhachet.repo.yml is read from the package root')
    then('role directories are discovered from yml config')
    then('init scripts are discovered from yml config')
      sothat('package manifest drives discovery')

given('a rhachet-roles package without rhachet.repo.yml')
  when('user runs `npx rhachet init --roles mechanic`')
    then('error: package lacks rhachet.repo.yml')
    then('error suggests run of `npx rhachet repo introspect` in the package')
      sothat('users know how to fix the issue')
```

---

## edge.1 = role not found

```
given('a repo with rhachet-roles packages installed')
  when('consumer runs `npx rhachet init --roles nonexistent`')
    then('command fails fast before any roles are linked or initialized')
    then('error: role "nonexistent" not found in any installed package')
    then('error asks: "do you need to npm install a repo?"')
    then('error lists available roles from all packages')
      sothat('consumers know to install the package that provides the role')
```

---

## edge.2 = init script failure

```
given('a role with a failed init script')
  when('user runs `npx rhachet init --roles mechanic behaver`')
    when('mechanic init succeeds but behaver init fails')
      then('mechanic remains linked and initialized')
      then('error shows which role init failed')
      then('error shows the failure reason')
        sothat('partial success is preserved and failures are clear')
```

---

## edge.3 = no rhachet-roles packages installed

```
given('a repo with no rhachet-roles packages in package.json')
  when('user runs `npx rhachet init --roles mechanic`')
    then('error: no rhachet-roles packages found')
    then('error suggests install of a rhachet-roles package')
      sothat('users know to install role packages first')
```

---

## edge.4 = mixed disambiguation

```
given('multiple rhachet-roles packages installed')
  when('user runs `npx rhachet init --roles mechanic ehmpathy/reviewer`')
    when('mechanic is unique across all packages')
      then('mechanic is initialized without disambiguation')
      then('reviewer is initialized from ehmpathy package')
        sothat('disambiguation is only required when ambiguous')

    when('mechanic exists in multiple packages')
      then('error for mechanic disambiguation')
      then('reviewer still initializes from ehmpathy package')
        sothat('unambiguous roles proceed while ambiguous ones error')
```

---

## boundary.1 = valid rhachet-roles package identification

```
given('packages in node_modules')
  when('package name matches pattern rhachet-roles-*')
    then('package is considered a rhachet-roles package')
      sothat('discovery is based on name convention')

  when('package name does not match pattern')
    then('package is ignored for role discovery')
```

---

## boundary.2 = rhachet.repo.yml schema

```
given('a rhachet.repo.yml file')
  when('yml contains roles with dirs and inits')
    then('dirs specifies path to role briefs and skills')
    then('inits specifies list of init scripts for that role')

  when('yml is malformed or lacks required fields')
    then('error: invalid rhachet.repo.yml')
    then('error specifies which field is absent or malformed')
```

---

## boundary.3 = backward compatibility

```
given('a repo with rhachet.use.ts that defines roles')
  when('user runs `npx rhachet init --roles mechanic`')
    then('role from installed package takes precedence over rhachet.use.ts')
      sothat('new pattern is preferred over legacy pattern')

  when('user runs prior commands like `npx rhachet roles boot`')
    then('command works as before via rhachet.use.ts')
      sothat('prior workflows are not broken')
```

---

## boundary.4 = documentation

```
given('a consumer who wants to initialize roles')
  when('they read the project README')
    then('README documents `npx rhachet init --roles` command')
    then('README documents repo/role disambiguation pattern')
    then('README shows example invocations')
      sothat('consumers can learn how to use the feature')

given('a producer who creates a rhachet-roles package')
  when('they read the project README')
    then('README documents `npx rhachet repo introspect` command')
    then('README documents rhachet.repo.yml schema')
      sothat('producers know how to make their packages compatible')
```
