# usecase.1 = invoke skills via rhx shorthand

given('user has rhachet installed locally in a repo')
  when('user runs `npx rhx say-hello`')
    then('skill executes identically to `npx rhachet run --skill say-hello`')
      sothat('users save keystrokes for the most common rhachet operation')
    then('stdout/stderr output is identical')
    then('exit code is identical')

  when('user runs `npx rhx say-hello --some-option value`')
    then('all arguments pass through to the skill')
      sothat('skill options work transparently')

  when('user runs `npx rhx nonexistent-skill`')
    then('error message matches `npx rhachet run --skill nonexistent-skill`')
      sothat('error experience is consistent')

given('user has rhachet installed globally')
  when('user runs `rhx say-hello` from a rhachet-enabled repo')
    then('skill executes identically to `rhachet run --skill say-hello`')
      sothat('global installation provides same experience as local')

  when('user runs `rhx say-hello` from a non-rhachet directory')
    then('error message indicates no rhachet config found')
      sothat('users understand why it failed')

# usecase.2 = install rhachet with rhx alias globally

given('user wants to install rhachet globally')
  when('user runs `npm install -g rhachet`')
    then('both `rhachet` and `rhx` commands become available in PATH')
      sothat('users get the shorthand automatically')
    then('`rhx --version` outputs same version as `rhachet --version`')

  when('user runs `pnpm add -g rhachet`')
    then('both `rhachet` and `rhx` commands become available in PATH')
      sothat('pnpm users get same experience as npm users')
    then('`rhx --version` outputs same version as `rhachet --version`')

  when('user runs `rhachet --help`')
    then('help output mentions `rhx` as the shorthand for `run --skill`')
      sothat('users discover the alias exists')

# usecase.3 = npx without global install

given('user does not have rhachet installed globally')
  when('user runs `npx rhx say-hello` in a rhachet-enabled repo')
    then('skill executes successfully via npx resolution')
      sothat('users can use shorthand without global install')

# usecase.4 = readme documents rhx alias

given('user reads the rhachet readme')
  when('user looks for how to run skills')
    then('readme shows `rhx` as the preferred shorthand')
      sothat('users discover the easier syntax first')
    then('readme shows example: `npx rhx say-hello`')
    then('readme explains `rhx` is equivalent to `rhachet run --skill`')
      sothat('users understand the relationship')

  when('user looks for installation instructions')
    then('readme shows both npm and pnpm global install options')
    then('readme confirms both `rhachet` and `rhx` become available after global install')

# usecase.5 = disambiguation behavior preserved

given('repo has multiple skills with same name across repos/roles')
  when('user runs `rhx ambiguous-skill`')
    then('disambiguation error matches `rhachet run --skill ambiguous-skill`')

  when('user runs `rhx ambiguous-skill --repo .this --role any`')
    then('disambiguation options work identically')
      sothat('all run --skill options remain available via rhx')
