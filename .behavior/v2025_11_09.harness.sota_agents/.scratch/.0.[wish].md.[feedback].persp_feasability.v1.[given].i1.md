# Feasibility Assessment: Harnessing SOTA Agents in Rhachet

## Overall Verdict: **HIGHLY FEASIBLE** âœ“

The core wish to harness claude-code and similar SOTA agents within rhachet is technically achievable with the existing technology stack.

---

## Key Question: CLI with Constrained Context?

### YES - Multiple Proven Approaches:

1. **Docker Container Isolation**
   - Mount specific directories as volumes
   - Control filesystem access precisely
   - Example: `docker run -v /path/to/brief:/workspace claude-code`
   - Each agent instance gets isolated environment

2. **OpenEnv / Process Isolation**
   - Set working directory via `cwd` parameter
   - Use environment variables for API keys
   - Constrain file access via permissions
   - Invoke: `claude-code --cwd /constrained/path`

3. **Chroot / Namespace Isolation**
   - Linux namespaces for filesystem isolation
   - More lightweight than Docker
   - Same outcome: constrained context

---

## Technical Feasibility Breakdown

### âœ“ FEASIBLE Components:

**CLI Invocation**
- Claude Code supports programmatic invocation
- Can pass prompts via stdin or args
- Capture stdout/stderr for structured output
- Exit codes indicate success/failure

**Parallel Attempts**
- Run N instances simultaneously
- Each in isolated container/process
- Aggregate results for comparison
- Cost: ~N Ã— single invocation

**Brief Booting**
- Pre-populate workspace with briefs
- Mount as read-only volumes
- Agent reads context on startup
- Works with `.behavior/` structure

**Thought Routes (prepare â†’ review â†’ release)**
- Chain invocations sequentially
- Pass output from step N to step N+1
- Store intermediate artifacts
- Orchestration via bash/node/python

**Self-Review**
- Agent 1: produces artifact
- Agent 2: reviews against criteria
- Agent 3: incorporates feedback
- Format output as BLOCKERS + NITPICKS

**Deterministic Guarantees**
- Use temperature=0 for consistency
- Fixed seed (if available)
- Same brief + same prompt = similar output
- Note: Not 100% deterministic, but close

---

## Implementation Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rhachet Orchestrator                   â”‚
â”‚  â”œâ”€ boots briefs                        â”‚
â”‚  â”œâ”€ prepares constrained context        â”‚
â”‚  â””â”€ invokes route                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           â”‚
    â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Attempt 1â”‚              â”‚ Attempt Nâ”‚
â”‚ (Docker) â”‚     ...      â”‚ (Docker) â”‚
â”‚ claude-  â”‚              â”‚ claude-  â”‚
â”‚ code     â”‚              â”‚ code     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Review Agent â”‚
          â”‚ (analyzes    â”‚
          â”‚  attempts)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Release Gate â”‚
          â”‚ (coherence,  â”‚
          â”‚  security,   â”‚
          â”‚  criteria)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Challenges & Mitigations

### ğŸŸ¡ Cost Management
- **Issue**: Parallel attempts Ã— SOTA pricing = expensive
- **Mitigation**:
  - Configurable parallelism (1-5 attempts)
  - Cost caps per route
  - Use smaller models for reviews

### ğŸŸ¡ Non-Determinism
- **Issue**: Same input may yield different outputs
- **Mitigation**:
  - Temperature=0 reduces variance
  - Multiple attempts help identify consensus
  - Review step catches inconsistencies

### ğŸŸ¡ Rate Limits
- **Issue**: API providers throttle requests
- **Mitigation**:
  - Queue-based scheduling
  - Retry with backoff
  - Distribute across API keys if needed

### ğŸŸ¡ Context Size Limits
- **Issue**: Large briefs + codebases may exceed token limits
- **Mitigation**:
  - Brief summarization
  - Focused context windows
  - Streaming for large outputs

### ğŸŸ¡ Orchestration Complexity
- **Issue**: Building the routing layer is non-trivial
- **Mitigation**:
  - Start with simple bash scripts
  - Evolve to structured workflows
  - Leverage existing tools (e.g., Temporal, Prefect)

---

## Concrete Next Steps

1. **Prototype**: Single claude-code invocation in Docker with mounted brief
2. **Validate**: Can we boot briefs and get coherent output?
3. **Parallelize**: Run 3 attempts simultaneously, compare results
4. **Route**: Implement prepare â†’ review â†’ release chain
5. **Integrate**: Build rhachet CLI command: `rhachet route <ask> --agent claude-code --attempts 3`

---

## Specific Answer: Docker / OpenEnv

**Docker**: âœ“ WORKS
```bash
docker run -v $(pwd)/.behavior:/app/.behavior \
           -e ANTHROPIC_API_KEY=$ANTHROPIC_API_KEY \
           -w /app \
           claude-code-image \
           --prompt "Review this code for security issues"
```

**OpenEnv**: âœ“ LIKELY WORKS (needs testing)
- If OpenEnv is a process isolation framework: yes
- If it supports working directory constraints: yes
- If it allows env var injection: yes
- Primary requirement: ability to spawn subprocess with constrained context

---

## Risk Assessment

**Technical Risk**: ğŸŸ¢ LOW
- All components are proven technologies
- Docker/containers are mature
- CLI invocation is straightforward

**Integration Risk**: ğŸŸ¡ MEDIUM
- Orchestration layer needs careful design
- State management across steps
- Error handling for partial failures

**Cost Risk**: ğŸŸ¡ MEDIUM
- SOTA models are expensive
- Parallel attempts multiply costs
- Needs budget controls

**Adoption Risk**: ğŸŸ¢ LOW
- Brings familiar tools (claude-code) into rhachet
- Users can use their "favorite brains"
- Incremental adoption path

---

## Conclusion

**This wish is implementable with current technology.**

The ability to harness claude-code via CLI with constrained context is not only possible, but straightforward using Docker or similar isolation mechanisms. The main work is building the orchestration layer to:

1. Boot briefs into constrained environment
2. Invoke SOTA agents with specific asks
3. Collect and compare parallel attempts
4. Route through review gates
5. Release validated artifacts

The rhachet framework's structured approach to thought routes (prepare â†’ review â†’ release) maps cleanly onto orchestrated SOTA agent invocations.

**Recommendation**: Proceed with prototype to validate assumptions and refine architecture.
